# Comparing `tmp/ModelFlowIb-2.5-py3-none-any.whl.zip` & `tmp/ModelFlowIb-2.7-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,51 +1,51 @@
-Zip file size: 1013844 bytes, number of entries: 49
--rw-rw-rw-  2.0 fat     1657 b- defN 23-Sep-26 21:19 modelBLfunk.py
--rw-rw-rw-  2.0 fat    11864 b- defN 23-Sep-26 21:19 model_Excel.py
--rw-rw-rw-  2.0 fat     5832 b- defN 23-Sep-26 21:19 model_cvx.py
--rw-rw-rw-  2.0 fat      983 b- defN 23-Sep-26 21:19 model_doable.py
--rw-rw-rw-  2.0 fat     7693 b- defN 23-Sep-26 21:19 model_dynare.py
--rw-rw-rw-  2.0 fat     3084 b- defN 23-Sep-26 21:19 model_financial_stability.py
--rw-rw-rw-  2.0 fat     2949 b- defN 23-Sep-26 21:19 model_ifrs9.py
--rw-rw-rw-  2.0 fat    19212 b- defN 23-Sep-26 21:19 model_latex.py
--rw-rw-rw-  2.0 fat    24289 b- defN 23-Sep-26 21:19 model_latex_class.py
+Zip file size: 1016690 bytes, number of entries: 49
+-rw-rw-rw-  2.0 fat     1657 b- defN 23-Oct-09 12:35 modelBLfunk.py
+-rw-rw-rw-  2.0 fat    11864 b- defN 23-Oct-09 12:35 model_Excel.py
+-rw-rw-rw-  2.0 fat     5832 b- defN 23-Oct-09 12:35 model_cvx.py
+-rw-rw-rw-  2.0 fat      983 b- defN 23-Oct-09 12:35 model_doable.py
+-rw-rw-rw-  2.0 fat     7693 b- defN 23-Oct-09 12:35 model_dynare.py
+-rw-rw-rw-  2.0 fat     3084 b- defN 23-Oct-09 12:35 model_financial_stability.py
+-rw-rw-rw-  2.0 fat     2949 b- defN 23-Oct-09 12:35 model_ifrs9.py
+-rw-rw-rw-  2.0 fat    19212 b- defN 23-Oct-09 12:35 model_latex.py
+-rw-rw-rw-  2.0 fat    24289 b- defN 23-Oct-09 12:35 model_latex_class.py
 -rw-rw-rw-  2.0 fat    14040 b- defN 23-Jan-31 22:04 model_latex_classpy.py
--rw-rw-rw-  2.0 fat      251 b- defN 23-Sep-26 21:19 model_run_numba.py
--rw-rw-rw-  2.0 fat   345187 b- defN 23-Sep-26 21:19 modelclass.py
--rw-rw-rw-  2.0 fat    19545 b- defN 23-Sep-26 21:19 modelclass2.py
--rw-rw-rw-  2.0 fat    10641 b- defN 23-Sep-26 21:19 modeldash.py
--rw-rw-rw-  2.0 fat     7516 b- defN 23-Sep-26 21:19 modeldashboot.py
--rw-rw-rw-  2.0 fat    18332 b- defN 23-Sep-26 21:19 modeldashsidebar.py
--rw-rw-rw-  2.0 fat    23581 b- defN 23-Sep-26 21:19 modeldekom.py
--rw-rw-rw-  2.0 fat    22500 b- defN 23-Sep-26 21:19 modeldiff.py
--rw-rw-rw-  2.0 fat    10003 b- defN 23-Sep-26 21:19 modelfeedback.py
--rw-rw-rw-  2.0 fat    14769 b- defN 23-Sep-26 21:19 modelgrab.py
--rw-rw-rw-  2.0 fat    28130 b- defN 23-Sep-26 21:19 modelgrabwf2.py
--rw-rw-rw-  2.0 fat     9969 b- defN 23-Sep-26 21:19 modelhelp.py
--rw-rw-rw-  2.0 fat    11205 b- defN 23-Sep-26 21:19 modelinvert.py
--rw-rw-rw-  2.0 fat    34216 b- defN 23-Sep-26 21:19 modeljupyter.py
--rw-rw-rw-  2.0 fat    13188 b- defN 23-Sep-26 21:19 modeljupytermagic.py
--rw-rw-rw-  2.0 fat     3771 b- defN 23-Sep-26 21:19 modelmacrograb.py
--rw-rw-rw-  2.0 fat    56532 b- defN 23-Sep-26 21:19 modelmanipulation.py
--rw-rw-rw-  2.0 fat     9586 b- defN 23-Sep-26 21:19 modelmf.py
--rw-rw-rw-  2.0 fat     4960 b- defN 23-Sep-26 21:19 modelnet.py
--rw-rw-rw-  2.0 fat    40003 b- defN 23-Sep-26 21:19 modelnewton.py
--rw-rw-rw-  2.0 fat    14670 b- defN 23-Sep-26 21:19 modelnormalize.py
--rw-rw-rw-  2.0 fat    12499 b- defN 23-Sep-26 21:19 modelpattern.py
--rw-rw-rw-  2.0 fat     3103 b- defN 23-Sep-26 21:19 modelpatternrev.py
--rw-rw-rw-  2.0 fat     1502 b- defN 23-Sep-26 21:19 modelsandbox.py
--rw-rw-rw-  2.0 fat    83735 b- defN 23-Sep-26 21:19 modelsandbox_Mixin.py
--rw-rw-rw-  2.0 fat      473 b- defN 23-Sep-26 21:19 modeltodo.py
--rw-rw-rw-  2.0 fat     3315 b- defN 23-Sep-26 21:19 modeluserfunk.py
--rw-rw-rw-  2.0 fat     3072 b- defN 23-Sep-26 21:19 modeluserfunk_old.py
--rw-rw-rw-  2.0 fat    33617 b- defN 23-Sep-26 21:19 modelvis.py
--rw-rw-rw-  2.0 fat    24750 b- defN 23-Sep-26 21:19 modelwidget.py
--rw-rw-rw-  2.0 fat    48812 b- defN 23-Sep-26 21:19 modelwidget_input.py
--rw-rw-rw-  2.0 fat    40341 b- defN 23-Sep-26 21:19 modelwidget_new.py
--rw-rw-rw-  2.0 fat    49238 b- defN 23-Sep-26 21:19 modelwidget_new_new.py
--rw-rw-rw-  2.0 fat    37448 b- defN 23-Sep-26 21:19 modelwidget_shinypy.py
+-rw-rw-rw-  2.0 fat      251 b- defN 23-Oct-09 12:35 model_run_numba.py
+-rw-rw-rw-  2.0 fat   354616 b- defN 23-Oct-09 12:35 modelclass.py
+-rw-rw-rw-  2.0 fat    19545 b- defN 23-Oct-09 12:35 modelclass2.py
+-rw-rw-rw-  2.0 fat    10641 b- defN 23-Oct-09 12:35 modeldash.py
+-rw-rw-rw-  2.0 fat     7516 b- defN 23-Oct-09 12:35 modeldashboot.py
+-rw-rw-rw-  2.0 fat    18332 b- defN 23-Oct-09 12:35 modeldashsidebar.py
+-rw-rw-rw-  2.0 fat    23581 b- defN 23-Oct-09 12:35 modeldekom.py
+-rw-rw-rw-  2.0 fat    22500 b- defN 23-Oct-09 12:35 modeldiff.py
+-rw-rw-rw-  2.0 fat    10003 b- defN 23-Oct-09 12:35 modelfeedback.py
+-rw-rw-rw-  2.0 fat    14769 b- defN 23-Oct-09 12:35 modelgrab.py
+-rw-rw-rw-  2.0 fat    28130 b- defN 23-Oct-09 12:35 modelgrabwf2.py
+-rw-rw-rw-  2.0 fat     9969 b- defN 23-Oct-09 12:35 modelhelp.py
+-rw-rw-rw-  2.0 fat    11213 b- defN 23-Oct-09 12:35 modelinvert.py
+-rw-rw-rw-  2.0 fat    34216 b- defN 23-Oct-09 12:35 modeljupyter.py
+-rw-rw-rw-  2.0 fat    13188 b- defN 23-Oct-09 12:35 modeljupytermagic.py
+-rw-rw-rw-  2.0 fat     3771 b- defN 23-Oct-09 12:35 modelmacrograb.py
+-rw-rw-rw-  2.0 fat    56532 b- defN 23-Oct-09 12:35 modelmanipulation.py
+-rw-rw-rw-  2.0 fat     9586 b- defN 23-Oct-09 12:35 modelmf.py
+-rw-rw-rw-  2.0 fat     4960 b- defN 23-Oct-09 12:35 modelnet.py
+-rw-rw-rw-  2.0 fat    40089 b- defN 23-Oct-09 12:35 modelnewton.py
+-rw-rw-rw-  2.0 fat    14670 b- defN 23-Oct-09 12:35 modelnormalize.py
+-rw-rw-rw-  2.0 fat    12499 b- defN 23-Oct-09 12:35 modelpattern.py
+-rw-rw-rw-  2.0 fat     3103 b- defN 23-Oct-09 12:35 modelpatternrev.py
+-rw-rw-rw-  2.0 fat     1502 b- defN 23-Oct-09 12:35 modelsandbox.py
+-rw-rw-rw-  2.0 fat    83735 b- defN 23-Oct-09 12:35 modelsandbox_Mixin.py
+-rw-rw-rw-  2.0 fat      473 b- defN 23-Oct-09 12:35 modeltodo.py
+-rw-rw-rw-  2.0 fat     3315 b- defN 23-Oct-09 12:35 modeluserfunk.py
+-rw-rw-rw-  2.0 fat     3072 b- defN 23-Oct-09 12:35 modeluserfunk_old.py
+-rw-rw-rw-  2.0 fat    33659 b- defN 23-Oct-09 12:35 modelvis.py
+-rw-rw-rw-  2.0 fat    24750 b- defN 23-Oct-09 12:35 modelwidget.py
+-rw-rw-rw-  2.0 fat    48812 b- defN 23-Oct-09 12:35 modelwidget_input.py
+-rw-rw-rw-  2.0 fat    40341 b- defN 23-Oct-09 12:35 modelwidget_new.py
+-rw-rw-rw-  2.0 fat    49238 b- defN 23-Oct-09 12:35 modelwidget_new_new.py
+-rw-rw-rw-  2.0 fat    37448 b- defN 23-Oct-09 12:35 modelwidget_shinypy.py
 -rw-rw-rw-  2.0 fat  3396666 b- defN 23-Jan-30 20:33 data/ken_base.pcim
--rw-rw-rw-  2.0 fat     7163 b- defN 23-Sep-26 21:19 ModelFlowIb-2.5.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Sep-26 21:19 ModelFlowIb-2.5.dist-info/WHEEL
--rw-rw-rw-  2.0 fat      619 b- defN 23-Sep-26 21:19 ModelFlowIb-2.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     3620 b- defN 23-Sep-26 21:19 ModelFlowIb-2.5.dist-info/RECORD
-49 files, 4540223 bytes uncompressed, 1008386 bytes compressed:  77.8%
+-rw-rw-rw-  2.0 fat     7163 b- defN 23-Oct-09 12:35 ModelFlowIb-2.7.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Oct-09 12:35 ModelFlowIb-2.7.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat      619 b- defN 23-Oct-09 12:35 ModelFlowIb-2.7.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     3620 b- defN 23-Oct-09 12:35 ModelFlowIb-2.7.dist-info/RECORD
+49 files, 4549788 bytes uncompressed, 1011232 bytes compressed:  77.8%
```

## zipnote {}

```diff
@@ -129,20 +129,20 @@
 
 Filename: modelwidget_shinypy.py
 Comment: 
 
 Filename: data/ken_base.pcim
 Comment: 
 
-Filename: ModelFlowIb-2.5.dist-info/METADATA
+Filename: ModelFlowIb-2.7.dist-info/METADATA
 Comment: 
 
-Filename: ModelFlowIb-2.5.dist-info/WHEEL
+Filename: ModelFlowIb-2.7.dist-info/WHEEL
 Comment: 
 
-Filename: ModelFlowIb-2.5.dist-info/top_level.txt
+Filename: ModelFlowIb-2.7.dist-info/top_level.txt
 Comment: 
 
-Filename: ModelFlowIb-2.5.dist-info/RECORD
+Filename: ModelFlowIb-2.7.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## modelclass.py

```diff
@@ -62,14 +62,17 @@
 import gc
 import copy
 import matplotlib.pyplot as plt
 import zipfile
 from functools import partial,cached_property,lru_cache
 from tqdm.auto import tqdm
 import operator
+from urllib.request import urlopen
+from io import BytesIO
+
 
 from matplotlib import rcParams
 rcParams.update({'figure.autolayout': True})
 rcParams.update({'figure.max_open_warning': 50})
 
 import seaborn as sns
 from IPython.display import SVG, display, Image, IFrame, HTML
@@ -1825,14 +1828,182 @@
     def print_model(self):
         print(self.equations)
 
     @property
     def print_model_latex(self):
         mj.get_frml_latex(self)
 
+    
+    @staticmethod
+    def get_a_repo_yaml(owner: str = "IbHansen",
+                       repo_name: str = "modelflow-manual",
+                       branch: str = 'main', 
+                       file:  str = r'papers/mfbook/repo_def.yaml'): 
+        """
+    Retrieve and load a YAML file from a specified GitHub repository.
+
+    Parameters:
+    - owner (str): The owner of the GitHub repository. Default is "IbHansen".
+    - repo_name (str): The name of the GitHub repository. Default is "modelflow-manual".
+    - branch (str): The branch where the file is located. Default is "main".
+    - file (str): The path to the file within the GitHub repository. Default is "papers/mfbook/repo_def.yaml".
+
+    Returns:
+    - dict or list: A dictionary or list containing the loaded YAML data.
+
+    Exceptions:
+    - Raises an exception if there is an error retrieving or loading the file, 
+      with the exception message printed to the console.
+      """  
+       
+        from urllib.request import urlopen
+        import yaml 
+        
+        url = Path(rf"https://raw.githubusercontent.com/{owner}/{repo_name}/{branch}/{file}").as_posix().replace('https:/','https://')
+      #  print(f'Open file from URL:  {url}')  
+        try:
+            with urlopen(url) as f:            
+                    res = yaml.safe_load(f)
+        except Exception as e:
+            print(f'{e}')
+    
+        return res 
+        
+    
+    
+    @staticmethod
+    def download_github_repo(owner: str = "IbHansen",
+                             repo_name: str = "pak",
+                             branch: str = 'main', 
+                             destination  = '.',
+                             go = True, 
+                             silent=True,
+                             **kwargs,
+                            ):
+        """
+        Download an entire GitHub repository and extract it to a specified location.
+    
+        Parameters:
+        - owner: The owner of the GitHub repository.
+        - repo_name: The name of the repository.
+        - branch: The branch to download.
+        - destination: The local path where the repository should be extracted.
+        - go: display toc of notebooks 
+        - silent: keep silent 
+        - description:optional description which will be used as folder name 
+    
+        Returns:
+        - A message indicating whether the download was successful or not.
+        """
+        # Construct the URL to download the zip file of the entire repository
+        url = f'https://github.com/{owner}/{repo_name}/archive/refs/heads/{branch}.zip'
+    
+        try:  
+            extract_to = Path(destination)  # Using pathlib.Path here
+            extract_to.mkdir(parents=True, exist_ok=True)  # Create the directory if it doesn't exist
+        except Exception as e:
+            return f"An error occurred creating {destination}: {e}"
+    
+        try:
+            # breakpoint()
+            # urllib.request.urlopen(urlfile) as f
+            with urlopen(url) as f:
+                with zipfile.ZipFile(BytesIO(f.read())) as z:
+                    # Extract all contents of the zip file to the specified location
+                    location = extract_to / f'{repo_name}-{branch}'
+                    new_location = extract_to / f'{kwargs.get("description",repo_name)}'
+                    if new_location.exists():
+                        raise Exception( f"Can't download to the same location twice, consider deleting before retry") 
+
+                    z.extractall(extract_to)
+                    try:
+                        location.rename(new_location)
+                    except: 
+                        print(f"Can't rename {location} to {new_location} you are probably using the folder just now")
+                        
+                    if not silent: 
+                        print(f'Repo downloaded to {new_location.resolve()}' )
+                    if go:
+                        model.display_toc('**Avaiable notebooks**')
+                    return location
+        except Exception as e:
+            raise Exception( f'No download of {kwargs.get("description",repo_name)}: {e} ') 
+            return f"An error occurred: {e}"
+
+    @staticmethod
+    def load_repo_widget(loadspec= None):
+        """
+Create an interactive widget for selecting and downloading repositories from GitHub.
+
+This function displays a list of repositories in a SelectMultiple widget, allowing the user to select one or more 
+repositories. Upon clicking the "Submit" button, the selected repositories are downloaded, and a confirmation 
+message is displayed for each successful download.
+
+Finaly a clicable toc of all notebooks is displayed
+
+Parameters:
+- loadspec (list of dict, optional): A list of dictionaries containing repository information. Each dictionary 
+  should have keys like 'description' and 'repo_name'. If not provided, the function will call `model.get_a_repo_yaml()` 
+  which retrives the default list from github,to retrieve the repository data. Default is None.
+
+Returns:
+- None: The function displays widgets and handles user interactions but does not return a value.
+
+Raises:
+- Exception: Prints exception messages to the output widget if errors occur during the download process.
+
+"""
+
+        
+        
+        # Create a SelectMultiple widget with descriptions as options
+ 
+        if type(loadspec)  == type(None):
+            data = model.get_a_repo_yaml()
+        else:
+            data = loadspec
+        
+ 
+        label = ip.HTML(value="<strong>Select the repositories to download:</strong>")
+        
+        select_multiple = ip.SelectMultiple(
+            options=[this.get('description', this['repo_name']) for this in data],
+            value=(),  # default selected value
+            description='Select from:',
+            rows=5  # Adjust as needed to change the height of the list
+        )
+        
+        out = ip.Output()
+    
+        # Create a button
+        button = ip.Button(description="Submit")
+    
+        # Function to handle button click
+        def on_button_click(b):
+            with out:
+                out.clear_output()  # Clear the output
+                selected_options = [item for item in data if item.get("description", item['repo_name']) in select_multiple.value]
+                
+                for repo_ident in selected_options:
+                    try:
+                        _ = model.download_github_repo(**repo_ident,go=False)  # Assuming 'model' is defined elsewhere
+                        print(f"Successfully downloaded {repo_ident.get('description',repo_ident['repo_name'])}")
+                    except Exception as e:
+                        print(f'{e}')
+                model.display_toc('**Avaiable notebooks**')
+                
+        # Attach the function to the button's click event
+        button.on_click(on_button_click)
+    
+        # Display the widgets
+        display(label,select_multiple, button, out)
+
+
+
+
 
 class Dekomp_Mixin():
     '''This class defines methods and properties related to equation attribution analyses (dekomp)
     '''
 
     @lru_cache(maxsize=2048)
     def dekomp(self, varnavn, start='', end='', basedf=None, altdf=None, lprint=True,time_att=False):
@@ -5008,14 +5179,16 @@
                     else:
                         display(
                             HTML(f'{blanks}<b>{str(Path.cwd().parts[-1])} (.)</b>'))
 
                 name = notebook.name.split('.')[0]
                 display(HTML(
                     f'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{blanks} <a href="{notebook}" target="_blank">{name}</a>'))
+
+
     @staticmethod
     def display_toc_this(pat='*',text='**Jupyter notebooks**',path='.',ext='ipynb',showext=False):
         
         '''In a jupyter notebook this function displays a clickable table of content in the folder pat with name in path'''
 
         from IPython.display import display, Markdown, HTML
         from pathlib import Path
@@ -5158,20 +5331,19 @@
              ----------
              infile : A file name or an url with a .pcim file
              funks : Functions to use in the resulting model
              run : simulate the model with the saved time and options 
              keep_json : save a dict (self.json_keep) in the model instance 
              default_url : TYPE, optional
                  Where to look if the file is not avaiable. The default is r'https://raw.githubusercontent.com/IbHansen/modelflow-manual/main/model_repo/'.
-             **kwargs : TYPE
-                 DESCRIPTION.
+             **kwargs : These options are used by the simulation if run=True
 
              Returns
              -------
-             None.
+             (<a model instance>,<a dataframe>) .
 
              '''
         '''Loads a model and an solution '''
         
         import urllib.request
 
         def make_current_from_quarters(base, json_current_per):
@@ -5388,15 +5560,74 @@
         :sim: If False forces a  model to be calculated (not solved) if True force simulation 
         :setbase: If True, place the result in model.basedf 
         :setlast: if False don't place the results in model.lastdf
 
         if the modelproperty previousbase is true, the previous run is used as basedf. 
 
 
+       
+
+        Parameters
+        ----------
+        sim : bool, optional
+            If False, forces a model to be calculated (not solved); if True, forces simulation. 
+            The default behavior is determined by the model's properties.
+
+        setbase : bool, optional
+            If True, places the result in model.basedf. Default is determined by the model's state.
+
+        setlast : bool, optional
+            If False, doesn't place the results in model.lastdf. Default is True.
+
+        antal : not applicable, optional
+            This option is not valid. If provided, an assertion error is raised.
+
+        do_calc_add_factor : bool, optional
+            Determines whether to calculate the adjustment factor if the calc adjust model is present. 
+            Default is True.
+
+        reset_options : bool, optional
+            If True, the previous options will be reset. Default is False.
+
+        save : bool, optional
+            If True, saves the current state. The default behavior is determined by the model's properties.
+
+        solver : str, optional
+            Specifies the solver to be used. The default solver is chosen based on the model's properties.
+
+        silent : bool, optional
+            If True, the solver runs silently without printing output to the console. Default is True.
+
+        cache_clear : bool, optional
+            If True, clears the cache after solving. Default is True.
+
+        keep : str, optional
+            If provided, keeps the solutions. The exact behavior depends on the 'keep_variables' option.
+
+        keep_variables : str or list of str, optional
+            Specifies which variables to keep if the 'keep' option is provided. Default is to keep all variables.
+
+        *args
+            Variable length argument list.
+
+        **kwargs
+            Arbitrary keyword arguments.
+
+        Returns
+        -------
+        outdf : pandas.DataFrame
+            The DataFrame containing the results of the model run.
+
+        Raises
+        ------
+        AssertionError
+            If the 'antal' option is provided, as it is not a valid simulation option.
         '''
+
+        
         
         if kwargs.get('antal', False):
             assert 1 == 2, 'Antal is not a valid simulation option, Use max_iterations'
         self.dumpdf = None
         
         do_calc_add_factor = kwargs.get('do_calc_add_factor',True)
         
@@ -5656,14 +5887,15 @@
         :type ljit: bool, optional
         :param timeon: Time the elements, defaults to False
         :type timeon: bool, optional
         :param fairopt: Fair taylor options, defaults to {'fair_max_iterations': 1}
         :type fairopt: TYPE, optional
         :param progressbar: Show progress bar , defaults to False
         :type progressbar: TYPE, optional
+        
         :return: A dataframe wilt the results 
         
         '''
         
         starttimesetup = time.time()
         fair_max_iterations = {**fairopt, **
                                kwargs}.get('fair_max_iterations ', 1)
```

## modelinvert.py

```diff
@@ -167,15 +167,15 @@
         ''' Calculates the instruments as a function of targets '''
         silent =  kwargs.get('silent',self.silent)
         self.maxiter = kwargs.get('maxiter',self.maxiter)
         self.nonlin = kwargs.get('nonlin',self.nonlin)
         progressbar = kwargs.get('progressbar',self.progressbar)
  
         tindex = self.model.current_per.copy()
-        res    = self.databank 
+        res    = self.databank.copy()  
 #        self.inv  = inv  = self.invjacobi(self.targets.index[0])
         self.inv  = inv  = self.invjacobi(self.targets.index[0],diag=shortfall,delay=delay) 
 
         self.conv = pd.Series([self.targetconv[v] for v in self.targetvars],self.targetvars)
 #        print(inv)
         oldsave = self.model.save
         bars = '{desc}: {percentage:3.0f}%|{bar}| {n_fmt}/{total_fmt}'
```

## modelnewton.py

```diff
@@ -143,15 +143,15 @@
                 def tout(t):
                     if t.lag:
                         return f'{t.var}({t.lag})'
                     return t.op+t.number+t.var
         
                 # breakpoint()      
                 nt = model.allvar[v]['terms']
-                assignpos = nt.index(model.aequalterm)                       # find the position of = 
+                assignpos = nt.index(model.aequalterm)                        # find the position of = 
                 rhsterms = nt[assignpos+1:-1]
                 vterm = udtryk_parse(rhv)[0]
                 plusterm =  udtryk_parse(f'({rhv}+{delta/2})',funks=model.funks)
                 minusterm = udtryk_parse(f'({rhv}-{delta/2})',funks=model.funks)
                 plus  = itertools.chain.from_iterable([plusterm if t == vterm else [t] for t in rhsterms])
                 minus = itertools.chain.from_iterable([minusterm if t == vterm else [t] for t in rhsterms])
                 eplus  = f'({"".join(tout(t) for t in plus)})'
@@ -625,15 +625,15 @@
     # #csc_matrix((data, (row_ind, col_ind)), [shape=(M, N)]) 
                 # print(f'endo:{endo} ,date:{date}, lag:{lag}, \n df')
                 self.diffvalues[var][pvar_name]=res                         
         return self.diffvalues
     
     
 
-    def get_eigenvectors(self,periode=None,asdf=True,filnan = False,silent=False,dropvar=None,i=0):
+    def get_eigenvectors(self,periode=None,asdf=True,filnan = False,silent=False,dropvar=None,dropvar_nr=0):
         
         first_element = lambda dic: dic[list(dic.keys())[0]]  # first element in a dict 
                 
         jacobiall = self.get_diff_mat_all_1per(periode,asdf=asdf)
         # breakpoint()
         if not silent: 
             for date,content in jacobiall.items():
@@ -660,15 +660,15 @@
         
         
         if type(dropvar)== type(None):
             A_dic = {date: {lag: df for lag,df in a_year.items() } for date,a_year in A_dic_gross.items() }
             
         else:
             A_dic = {date: {lag: df.drop(index=dropvar,columns=dropvar) for lag,df in a_year.items() } for date,a_year in A_dic_gross.items() }
-            print(f'{i} {dropvar}')
+            print(f'{dropvar_nr} {dropvar}')
         # breakpoint()    
         xlags = sorted([lag for lag in first_element(A_dic).keys() if lag !='lag=0'],key=lambda lag:int(lag.split('=')[1]),reverse=True)
         number=len(xlags)
         # dim = len(self.endovar) 
         first_A_dict = first_element(A_dic) # The first dict of A's 
         first_A = first_A_dict['lag=0'] 
         self.varnames = first_A.columns 
@@ -727,40 +727,36 @@
         
         self.A_dic = A_dic 
         self.comp_dic = comp_dic  
         self.eigen_values_and_vectors = eigen_values_and_vectors
         self.eig_dic = eig_dic
         return eig_dic
     
-    
-    @cached_property
-    def get_eigen_jackknife(self):
-        name_to_loop =self.varnames
+    @lru_cache(maxsize=None)   
+    def get_eigen_jackknife(self,maxnames = 20):
+        name_to_loop =[n for i,n in enumerate(self.varnames) if not n.endswith('_FITTED')]
         base_dict = {'ALL' : self.get_eigenvectors(dropvar=None )}
-        jackknife_dict = {f'{name}_excluded': self.get_eigenvectors(dropvar=name,i=i)  for i,name in enumerate(name_to_loop)}
+        jackknife_dict = {f'{name}_excluded': self.get_eigenvectors(dropvar=name,dropvar_nr=dropvar_nr)
+                    for dropvar_nr,name in enumerate(name_to_loop) if dropvar_nr  < maxnames}
         return {**base_dict, **jackknife_dict} 
 
      
-    def get_eigen_jackknife_abs(self):
-        base = self.get_eigen_jackknife
-        res = {name: {date: max([length for length in abs(eigenvalues)  ])
+    def get_eigen_jackknife_abs(self,largest=20,maxnames = 20):
+        base = self.get_eigen_jackknife(maxnames=maxnames)
+        res = {name: {date: np.sort(np.partition(np.abs(eigenvalues), -largest)[-largest:])[::-1]
+                    
                for date,eigenvalues in alldates.items()} 
                for name,alldates in base.items()}
         return res
 
-    def get_eigen_jackknife_abs_count(self):
-        base = self.get_eigen_jackknife
-        res = {name: {date: (abs(eigenvalues) > 1).sum() 
-               for date,eigenvalues in alldates.items()} 
-               for name,alldates in base.items()}
-        return res
    
-    def get_eigen_jackknife_abs_select(self,year=2023):
+    def get_eigen_jackknife_abs_select(self,year=2023,largest=20,maxnames = 20):
         
-        return {v: d[year] for v,d in self.get_eigen_jackknife_abs().items() }    
+        xx =  {v: sum(d[year]) for v,d in self.get_eigen_jackknife_abs(maxnames=maxnames,largest=largest).items() }    
+        return pd.Series(xx).sort_values() 
     
     def get_df_eigen_dict(self):
         rownames = [f'{c}{("("+str(l)+")") if l != 0 else ""}' for l in range(-1,self.mmodel.maxlag-1,-1) 
                        for c in self.varnames]   
         # breakpoint()
         values_and_vectors  = {per: [pd.DataFrame(vv[0],columns = ['Eigenvalues']).T, 
                    pd.DataFrame(vv[1],index = rownames) ]
```

## modelvis.py

```diff
@@ -74,22 +74,24 @@
     
      def heat(self,*args, **kwargs):
          ''' Displays a heatmap of the resulting dataframe'''
          
          name = kwargs.pop('title',self.__pat__)
          a = heatshow(self.thisdf.loc[self.model.current_per,:].T,
                       name=name,*args, **kwargs)
+         display(a)
          return a 
  
      def plot(self,*args, **kwargs):
          ''' Displays a plot for each of the columns in the resulting dataframe '''
          
          name = kwargs.get('title','Title')
          a = plotshow(self.thisdf.loc[self.model.current_per,:],
                       name=name,*args,**kwargs)
+         display(a)
          return a 
      
         
      def plot_alt(self,title='Title',*args, **kwargs):
          ''' Displays a plot for each of the columns in the resulting dataframe '''
          
          if hasattr(self.model,'var_description'):
```

## Comparing `ModelFlowIb-2.5.dist-info/METADATA` & `ModelFlowIb-2.7.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ModelFlowIb
-Version: 2.5
+Version: 2.7
 Summary: A tool to solve and manage dynamic economic models
 Home-page: https://https://github.com/IbHansen/ModelFlow2
 Author: Ib Hansen
 Author-email: Ib.Hansen.Iv@gmail.com
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: MIT License
 Requires-Python: >=3.8
```

## Comparing `ModelFlowIb-2.5.dist-info/top_level.txt` & `ModelFlowIb-2.7.dist-info/top_level.txt`

 * *Files identical despite different names*

## Comparing `ModelFlowIb-2.5.dist-info/RECORD` & `ModelFlowIb-2.7.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -5,45 +5,45 @@
 model_dynare.py,sha256=NTW6AxVf_knIk3PngP1O0PF7hP0u7_FtUMg_95fNeaM,7693
 model_financial_stability.py,sha256=3Wl20LV0T7EDcbf7THu2XXun-ParERaFatEGWG2EyKM,3084
 model_ifrs9.py,sha256=7wEoF8siKKVKnkPVoi12Bxl6ypOIrf3VbGJAbaO3Ct8,2949
 model_latex.py,sha256=9P7FYLWdNk8L4U-WL3PjSaRrMd0CUQ_7XlmUpyGTiq4,19212
 model_latex_class.py,sha256=tuXwgM5M_mPG3xyPPLqFgpgoPg5H24pLgJcCUhTJf0w,24289
 model_latex_classpy.py,sha256=z_QmHQ3CAfO9NIToXYjfbXdk9To3mPHdhlPuY8j43d8,14040
 model_run_numba.py,sha256=mIKcTVYZlVZFcsxnNF0a3LNNiOQwGnB0uo-drzj4V3U,251
-modelclass.py,sha256=DeuYNnvtfWHhygapRSkofe8gTm_FhvZEswXNpFsRhHc,345187
+modelclass.py,sha256=_uJVYssrqE8WFKKTzhix2IOFgtQ4Nj4DfwoJ0IBgOng,354616
 modelclass2.py,sha256=7CcH6axgmiKrYqEJxQDufXIE8w8VJHaN8Je1eOnBOPo,19545
 modeldash.py,sha256=Nns5JqAP5xjrdkD5752w2m9hwdm0F1mSi9RUNR0ZZRY,10641
 modeldashboot.py,sha256=rSyg5aYgRjVeJNHTGbE2X_1bvUmpW_sK-oYcDCrb_gU,7516
 modeldashsidebar.py,sha256=o1cyxM3ZWF_AJWMHyCzY-eL6Kk40zwztpPG4D0m-PHE,18332
 modeldekom.py,sha256=bMd4DRCyJr9wy21dQcowLM66wRIwYGebGq3ckre4il8,23581
 modeldiff.py,sha256=erNGFxi2jy-59yxfkMv5D9lBSPauuljXlPNU2twrQyM,22500
 modelfeedback.py,sha256=9pd4SX7AFTQscdpNUSio-kRK_eYs6r4ID4ooVv1JUUk,10003
 modelgrab.py,sha256=3bJJRzfGChNExTOGfxzCfkq8aPiXRnBNRfLBeRB-GMc,14769
 modelgrabwf2.py,sha256=uSgHToytbRGOAYYEt88cjWA0Tf1J2CT93gD4EAgZg_k,28130
 modelhelp.py,sha256=I-f0KU1t1dwvbUAHfQ0IvG-tuu3Cm_rrBTvPKkW1w7M,9969
-modelinvert.py,sha256=BucoHO25pNoBUc6TTcAgG3OPwOeyPdz2Loxxs6Odkek,11205
+modelinvert.py,sha256=FXJ8JF28ymhBmuEOlB4o0Ow5ZoTxc8Rk-GZXVqDyKh4,11213
 modeljupyter.py,sha256=9nhLpQkacJY4fYGdrR2N-cNdVRC7GaTkM_wzl3FezzI,34216
 modeljupytermagic.py,sha256=Cy6LjVa1j-TRoXqnLi5ZEtGliQ219Hyo3qwZOzEZWHg,13188
 modelmacrograb.py,sha256=tBoISMYPkuckiop0HaGSKb3OwMGbJejXKmyJNXAQGAo,3771
 modelmanipulation.py,sha256=v9aru_YgNe48ZfERqdWtR_LeBssAU-sl63Wc1IRsfEg,56532
 modelmf.py,sha256=1kfChecyVeZNiZX_llelT5eV4Sc63NFHU-FS2FaVMzQ,9586
 modelnet.py,sha256=dMvJ0mdY9OCVD-VvmVdis-9TgQbediHfsKLHGCKO4b4,4960
-modelnewton.py,sha256=w57FyHsqdW-qh2VWDOXlKHSeurueIekcCG-SFwMeZqE,40003
+modelnewton.py,sha256=XwFSGN9tf5nyGYgHS3N1srO8xCNr9MJZZnDSYmO6fD4,40089
 modelnormalize.py,sha256=HioJVD63t0FdsZokpCtF0dR2X1MUlLkHlgdUZfqJYfQ,14670
 modelpattern.py,sha256=sFx_Zp7ejzGVyP6AYyOlLdSUOe-OusnFvJWmSmpDKYg,12499
 modelpatternrev.py,sha256=UMmR4H6qqFOglpoU2qKBseeUkuUjzBRxj_x3VektSw4,3103
 modelsandbox.py,sha256=VJ9v3uBzoJ5qFUud0cW9ARAAMah-ePc9XmXpqJk6mfQ,1502
 modelsandbox_Mixin.py,sha256=zYMw_w25kAJwJ2bq9uV_uJaRBVmjfW6nMgyOw2rU37Y,83735
 modeltodo.py,sha256=RonsfA6D4zuR_C88d_yKepdgU_uIZ-BDqMDrGYpDS50,473
 modeluserfunk.py,sha256=71FKTR90N-FrvBlh_S_2-enqulQuWjrtwwwPmM3Mnnk,3315
 modeluserfunk_old.py,sha256=IEUivh0dKI1b1FELeLcbGcwEkzQl9kcKysEs6vu6rLs,3072
-modelvis.py,sha256=bp9NSBk_85VLFdUGXex5DPgDDFrReFQyKMjuwUsuXn0,33617
+modelvis.py,sha256=z65NGHb1hqXHDE3s7ZKtS2pUoRAvE7vyYYlkOVgSbkA,33659
 modelwidget.py,sha256=xSH25C6gLBDSGkjyep92BW7s9q7F-6m2yxwkvtRpgkk,24750
 modelwidget_input.py,sha256=gwU7Fep8mNeszUiJ8dR1bZG6mrvK86Yg83S1k7RoXNw,48812
 modelwidget_new.py,sha256=tlmmE65d419cyZgMkHZiOk5Zrvt6--H2tvsNr1N-jDc,40341
 modelwidget_new_new.py,sha256=OnAi9e7yaD2a9PHAqmpNd9gEo3qk3IsKKqeMsx5ZyHM,49238
 modelwidget_shinypy.py,sha256=Dkf2nWsS-IK-_goSifOU0A5AJmGDV0wSOV_TV0r0J1A,37448
 data/ken_base.pcim,sha256=bIL06bfurtQvEpQEyvrDWJl1D3tebxna11QaOvY35cI,3396666
-ModelFlowIb-2.5.dist-info/METADATA,sha256=2Ha-7F1RQxMGr7xWQFzo4CFMJfh8DoCFfZFyqR-QCrg,7163
-ModelFlowIb-2.5.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
-ModelFlowIb-2.5.dist-info/top_level.txt,sha256=Sn2Nx7m1gMhXmo8uNKwR5RNADR5dVBh7tnDMYEilCGA,619
-ModelFlowIb-2.5.dist-info/RECORD,,
+ModelFlowIb-2.7.dist-info/METADATA,sha256=z6-Gz52bk9Swq-eCB9tpUfOdUpDHPLh9HvkFYl9ebgk,7163
+ModelFlowIb-2.7.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+ModelFlowIb-2.7.dist-info/top_level.txt,sha256=Sn2Nx7m1gMhXmo8uNKwR5RNADR5dVBh7tnDMYEilCGA,619
+ModelFlowIb-2.7.dist-info/RECORD,,
```

