# Comparing `tmp/atlas_init-0.1.0-py3-none-any.whl.zip` & `tmp/atlas_init-0.1.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,45 +1,46 @@
-Zip file size: 51382 bytes, number of entries: 61
+Zip file size: 57072 bytes, number of entries: 62
 -rw-r--r--  2.0 unx      376 b- defN 20-Feb-02 00:00 atlas_init/__init__.py
 -rw-r--r--  2.0 unx       52 b- defN 20-Feb-02 00:00 atlas_init/__main__.py
--rw-r--r--  2.0 unx     1552 b- defN 20-Feb-02 00:00 atlas_init/atlas_init.yaml
--rw-r--r--  2.0 unx     9168 b- defN 20-Feb-02 00:00 atlas_init/cli.py
+-rw-r--r--  2.0 unx     1518 b- defN 20-Feb-02 00:00 atlas_init/atlas_init.yaml
+-rw-r--r--  2.0 unx     9639 b- defN 20-Feb-02 00:00 atlas_init/cli.py
 -rw-r--r--  2.0 unx      427 b- defN 20-Feb-02 00:00 atlas_init/cli_args.py
 -rw-r--r--  2.0 unx      726 b- defN 20-Feb-02 00:00 atlas_init/terraform.yaml
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/cli_cfn/__init__.py
 -rw-r--r--  2.0 unx     9857 b- defN 20-Feb-02 00:00 atlas_init/cli_cfn/app.py
 -rw-r--r--  2.0 unx    12492 b- defN 20-Feb-02 00:00 atlas_init/cli_cfn/cfn.py
 -rw-r--r--  2.0 unx     7441 b- defN 20-Feb-02 00:00 atlas_init/cli_cfn/cfn_parameter_finder.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/__init__.py
--rw-r--r--  2.0 unx     1047 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/go.py
+-rw-r--r--  2.0 unx     1232 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/go.py
 -rw-r--r--  2.0 unx     2517 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/run.py
 -rw-r--r--  2.0 unx     2983 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/sdk.py
 -rw-r--r--  2.0 unx      189 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/sdk_auto_changes.py
--rw-r--r--  2.0 unx     3799 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/tf_runner.py
+-rw-r--r--  2.0 unx     3690 b- defN 20-Feb-02 00:00 atlas_init/cli_helper/tf_runner.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/cli_tf/__init__.py
 -rw-r--r--  2.0 unx     2644 b- defN 20-Feb-02 00:00 atlas_init/cli_tf/app.py
 -rw-r--r--  2.0 unx     3258 b- defN 20-Feb-02 00:00 atlas_init/cli_tf/schema.py
 -rw-r--r--  2.0 unx     1764 b- defN 20-Feb-02 00:00 atlas_init/cli_tf/schema_inspection.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/cloud/__init__.py
 -rw-r--r--  2.0 unx     2473 b- defN 20-Feb-02 00:00 atlas_init/cloud/aws.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/repos/__init__.py
 -rw-r--r--  2.0 unx     2279 b- defN 20-Feb-02 00:00 atlas_init/repos/cfn.py
 -rw-r--r--  2.0 unx      424 b- defN 20-Feb-02 00:00 atlas_init/repos/go_sdk.py
 -rw-r--r--  2.0 unx     4160 b- defN 20-Feb-02 00:00 atlas_init/repos/path.py
 -rw-r--r--  2.0 unx        0 b- defN 20-Feb-02 00:00 atlas_init/settings/__init__.py
--rw-r--r--  2.0 unx     5523 b- defN 20-Feb-02 00:00 atlas_init/settings/config.py
--rw-r--r--  2.0 unx     8423 b- defN 20-Feb-02 00:00 atlas_init/settings/env_vars.py
+-rw-r--r--  2.0 unx     5894 b- defN 20-Feb-02 00:00 atlas_init/settings/config.py
+-rw-r--r--  2.0 unx     8745 b- defN 20-Feb-02 00:00 atlas_init/settings/env_vars.py
 -rw-r--r--  2.0 unx      340 b- defN 20-Feb-02 00:00 atlas_init/settings/interactive.py
 -rw-r--r--  2.0 unx     1998 b- defN 20-Feb-02 00:00 atlas_init/settings/path.py
--rw-r--r--  2.0 unx      491 b- defN 20-Feb-02 00:00 atlas_init/settings/rich_utils.py
--rw-r--r--  2.0 unx     1020 b- defN 20-Feb-02 00:00 atlas_init/tf/always.tf
+-rw-r--r--  2.0 unx     1601 b- defN 20-Feb-02 00:00 atlas_init/settings/rich_utils.py
+-rw-r--r--  2.0 unx     8206 b- defN 20-Feb-02 00:00 atlas_init/tf/.terraform.lock.hcl
+-rw-r--r--  2.0 unx     1102 b- defN 20-Feb-02 00:00 atlas_init/tf/always.tf
 -rw-r--r--  2.0 unx     3824 b- defN 20-Feb-02 00:00 atlas_init/tf/main.tf
 -rw-r--r--  2.0 unx     3452 b- defN 20-Feb-02 00:00 atlas_init/tf/outputs.tf
 -rw-r--r--  2.0 unx      724 b- defN 20-Feb-02 00:00 atlas_init/tf/providers.tf
--rw-r--r--  2.0 unx     1860 b- defN 20-Feb-02 00:00 atlas_init/tf/variables.tf
+-rw-r--r--  2.0 unx     1925 b- defN 20-Feb-02 00:00 atlas_init/tf/variables.tf
 -rw-r--r--  2.0 unx      738 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/aws_s3/aws_s3.tf
 -rw-r--r--  2.0 unx      162 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/aws_s3/provider.tf
 -rw-r--r--  2.0 unx      386 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/aws_vars/aws_vars.tf
 -rw-r--r--  2.0 unx     1838 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/aws_vpc/aws-vpc.tf
 -rw-r--r--  2.0 unx      162 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/aws_vpc/provider.tf
 -rw-r--r--  2.0 unx       94 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/cfn/assume_role_services.yaml
 -rw-r--r--  2.0 unx     2065 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/cfn/cfn.tf
@@ -52,12 +53,12 @@
 -rw-r--r--  2.0 unx      162 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/federated_vars/provider.tf
 -rw-r--r--  2.0 unx     1020 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/project_extra/project_extra.tf
 -rw-r--r--  2.0 unx      611 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/stream_instance/stream_instance.tf
 -rw-r--r--  2.0 unx     2208 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/vpc_peering/vpc_peering.tf
 -rw-r--r--  2.0 unx     1298 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/vpc_privatelink/atlas-privatelink.tf
 -rw-r--r--  2.0 unx      255 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/vpc_privatelink/variables.tf
 -rw-r--r--  2.0 unx      238 b- defN 20-Feb-02 00:00 atlas_init/tf/modules/vpc_privatelink/versions.tf
-?rw-r--r--  2.0 unx     4763 b- defN 20-Feb-02 00:00 atlas_init-0.1.0.dist-info/METADATA
-?rw-r--r--  2.0 unx       87 b- defN 20-Feb-02 00:00 atlas_init-0.1.0.dist-info/WHEEL
-?rw-r--r--  2.0 unx       54 b- defN 20-Feb-02 00:00 atlas_init-0.1.0.dist-info/entry_points.txt
-?rw-r--r--  2.0 unx     5472 b- defN 20-Feb-02 00:00 atlas_init-0.1.0.dist-info/RECORD
-61 files, 124683 bytes uncompressed, 42536 bytes compressed:  65.9%
+?rw-r--r--  2.0 unx     5504 b- defN 20-Feb-02 00:00 atlas_init-0.1.1.dist-info/METADATA
+?rw-r--r--  2.0 unx       87 b- defN 20-Feb-02 00:00 atlas_init-0.1.1.dist-info/WHEEL
+?rw-r--r--  2.0 unx       54 b- defN 20-Feb-02 00:00 atlas_init-0.1.1.dist-info/entry_points.txt
+?rw-r--r--  2.0 unx     5563 b- defN 20-Feb-02 00:00 atlas_init-0.1.1.dist-info/RECORD
+62 files, 136184 bytes uncompressed, 48084 bytes compressed:  64.7%
```

## zipnote {}

```diff
@@ -90,14 +90,17 @@
 
 Filename: atlas_init/settings/path.py
 Comment: 
 
 Filename: atlas_init/settings/rich_utils.py
 Comment: 
 
+Filename: atlas_init/tf/.terraform.lock.hcl
+Comment: 
+
 Filename: atlas_init/tf/always.tf
 Comment: 
 
 Filename: atlas_init/tf/main.tf
 Comment: 
 
 Filename: atlas_init/tf/outputs.tf
@@ -165,20 +168,20 @@
 
 Filename: atlas_init/tf/modules/vpc_privatelink/variables.tf
 Comment: 
 
 Filename: atlas_init/tf/modules/vpc_privatelink/versions.tf
 Comment: 
 
-Filename: atlas_init-0.1.0.dist-info/METADATA
+Filename: atlas_init-0.1.1.dist-info/METADATA
 Comment: 
 
-Filename: atlas_init-0.1.0.dist-info/WHEEL
+Filename: atlas_init-0.1.1.dist-info/WHEEL
 Comment: 
 
-Filename: atlas_init-0.1.0.dist-info/entry_points.txt
+Filename: atlas_init-0.1.1.dist-info/entry_points.txt
 Comment: 
 
-Filename: atlas_init-0.1.0.dist-info/RECORD
+Filename: atlas_init-0.1.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## atlas_init/__init__.py

```diff
@@ -1,10 +1,10 @@
 from pathlib import Path
 
-VERSION = "0.1.0"
+VERSION = "0.1.1"
 
 
 def running_in_repo() -> bool:
     py_directory = Path(__file__).parent.parent
     if py_directory.name != "py":
         return False
     git_directory = py_directory.parent / ".git"
```

## atlas_init/atlas_init.yaml

```diff
@@ -1,69 +1,69 @@
 repo_aliases:
-    mongodb/terraform-provider-mongodbatlas: tf
-    mongodb/mongodbatlas-cloudformation-resources: cfn
+  mongodb/terraform-provider-mongodbatlas: tf
+  mongodb/mongodbatlas-cloudformation-resources: cfn
 test_suites:
 - name: cluster
   repo_go_packages:
     cfn:
-      - 'cfn-resources/cluster'
+    - cfn-resources/cluster
 - name: federated
   repo_go_packages:
     tf:
-      - 'internal/service/federatedsettingsorgrolemapping'
+    - internal/service/federatedsettingsorgrolemapping
   vars:
     use_federated_vars: true
-- name: project
-  vars: 
-    use_project_extra: true
-  repo_go_packages:
-    cfn:
-    - 'cfn-resources/project'
-- name: network_peering
-  vars: 
-    use_aws_vpc: true
-    use_aws_vars: true
-    use_vpc_peering: true
+- name: network
   repo_go_packages:
     tf:
-    - 'internal/service/networkpeering'
-- name: network
-  vars: 
+    - internal/service/privatelinkendpointservicedatafederationonlinearchive
+  vars:
     use_private_link: true
+- name: network_peering
   repo_go_packages:
     tf:
-    - 'internal/service/privatelinkendpointservicedatafederationonlinearchive'
-- name: privatelink
+    - internal/service/networkpeering
   vars:
-    use_aws_vpc: true
+    use_vpc_peering: true
     use_aws_vars: true
+    use_aws_vpc: true
+- name: privatelink
   repo_go_packages:
     tf:
-    - 'internal/service/privatelinkendpointservice'
-- name: stream_connection
-  repo_go_packages: 
-    tf:
-    - 'internal/service/streamconnection'
-    cfn:
-    - 'cfn-resources/stream-connection'
+    - internal/service/privatelinkendpointservice
   vars:
-    cluster_info: true
-    stream_instance: true
-- name: search_index
+    use_aws_vars: true
+    use_aws_vpc: true
+- name: project
   repo_go_packages:
-    tf:
-    - 'internal/service/searchindex'
+    cfn:
+    - cfn-resources/project
   vars:
-    cluster_info: true
+    use_project_extra: true
 - name: s3
   repo_go_packages:
     tf:
-    - 'internal/service/cloudbackupsnapshotexportbucket'
+    - internal/service/cloudbackupsnapshotexportbucket
   vars:
     use_aws_s3: true
 - name: s3_with_cluster
   repo_go_packages:
     tf:
-    - 'internal/service/cloudbackupsnapshotexportjob'
+    - internal/service/cloudbackupsnapshotexportjob
   vars:
-    use_aws_s3: true
     cluster_info_m10: true
+    use_aws_s3: true
+- name: search_index
+  repo_go_packages:
+    tf:
+    - internal/service/searchindex
+  vars:
+    cluster_info: true
+- name: stream_connection
+  repo_go_packages:
+    tf:
+    - internal/service/streamconnection
+    cfn:
+    - cfn-resources/stream-connection
+  vars:
+    cluster_info: true
+    stream_instance: true
```

## atlas_init/cli.py

```diff
@@ -1,19 +1,21 @@
 import logging
+import os
 import sys
 from collections.abc import Callable
 from functools import partial
 from pydoc import locate
 
 import typer
 from zero_3rdparty.file_utils import iter_paths
 
 from atlas_init import running_in_repo
 from atlas_init.cli_cfn.app import app as app_cfn
 from atlas_init.cli_helper import sdk_auto_changes
+from atlas_init.cli_helper.go import run_go_tests
 from atlas_init.cli_helper.run import (
     run_binary_command_is_ok,
     run_command_exit_on_failure,
 )
 from atlas_init.cli_helper.sdk import (
     SDK_VERSION_HELP,
     SdkVersion,
@@ -51,15 +53,15 @@
     init_settings,
 )
 from atlas_init.settings.path import (
     CwdIsNoRepoPathError,
     dump_vscode_dotenv,
     repo_path_rel_path,
 )
-from atlas_init.settings.rich_utils import configure_logging
+from atlas_init.settings.rich_utils import configure_logging, hide_secrets
 
 logger = logging.getLogger(__name__)
 app = typer.Typer(name="atlas_init", invoke_without_command=True, no_args_is_help=True)
 app.add_typer(app_cfn, name="cfn")
 app.add_typer(app_tf, name="tf")
 
 app_command = partial(
@@ -85,29 +87,30 @@
         envvar=env_var_names("project_name"),
         help="atlas project name to create",
     ),
 ):
     explicit_env_vars: dict[str, str] = {}
     if project_name != "":
         explicit_env_vars[as_env_var_name("project_name")] = project_name
-    configure_logging(log_level)
+    log_handler = configure_logging(log_level)
     logger.info(f"running in repo: {running_in_repo()} python location:{sys.executable}")
     missing_env_vars, ambiguous_env_vars = AtlasInitSettings.check_env_vars(
         profile,
         required_extra_fields=["project_name"],
         explicit_env_vars=explicit_env_vars,
     )
     if missing_env_vars:
         typer.echo(f"missing env_vars: {missing_env_vars}")
     if ambiguous_env_vars:
         typer.echo(
             f"amiguous env_vars: {missing_env_vars} (specified both in cli & in .env-manual file with different values)"
         )
     if missing_env_vars or ambiguous_env_vars:
         raise typer.Exit(1)
+    hide_secrets(log_handler, {**os.environ})
     command = ctx.invoked_subcommand
     logger.info(f"in the app callback, log-level: {log_level}, command: {command}")
 
 
 @app_command()
 def init(context: typer.Context):
     settings = init_settings()
@@ -131,28 +134,31 @@
     tf_vars = get_tf_vars(settings, suites)
     dump_tf_vars(settings, tf_vars)
 
     try:
         run_terraform(settings, "apply", extra_args)
     except TerraformRunError as e:
         logger.error(repr(e))  # noqa: TRY400
-        return
+        raise typer.Exit(1) from e
 
     if not skip_outputs:
         export_outputs(settings)
 
     if settings.env_vars_generated.exists():
         dump_vscode_dotenv(settings.env_vars_generated, settings.env_vars_vs_code)
         logger.info(f"your .env file is ready @ {settings.env_vars_vs_code}")
 
 
 @app_command()
 def destroy(context: typer.Context):
     extra_args = context.args
     settings = init_settings()
+    if not settings.tf_state_path.exists():
+        logger.warning(f"no terraform state found  {settings.tf_state_path}, exiting")
+        return
     tf_vars = get_tf_vars(settings, [])
     dump_tf_vars(settings, tf_vars)
     try:
         run_terraform(settings, "destroy", extra_args)
     except TerraformRunError as e:
         logger.error(repr(e))  # noqa: TRY400
         return
@@ -160,17 +166,23 @@
 
 @app_command()
 def test_go():
     settings = init_settings()
     suites = active_suites(settings)
     sorted_suites = sorted(suite.name for suite in suites)
     logger.info(f"running go tests for {len(suites)} test-suites: {sorted_suites}")
-    raise NotImplementedError("fix me later!")  # noqa
-    # package_prefix = settings.config.go_package_prefix(repo_alias)
-    # run_go_tests(repo_path, repo_alias, package_prefix, settings, active_suites)
+    match repo_alias := current_repo():
+        case Repo.CFN:
+            raise NotImplementedError
+        case Repo.TF:
+            repo_path = current_repo_path()
+            package_prefix = settings.config.go_package_prefix(repo_alias)
+            run_go_tests(repo_path, repo_alias, package_prefix, settings, suites)
+        case _:
+            raise NotImplementedError
 
 
 @app_command()
 def sdk_upgrade(
     old: SdkVersion = typer.Argument(help=SDK_VERSION_HELP),
     new: SdkVersion = typer.Argument(
         default_factory=find_latest_sdk_version,
```

## atlas_init/cli_helper/go.py

```diff
@@ -1,28 +1,31 @@
 import logging
 import os
 from pathlib import Path
 
-import dotenv
-
 from atlas_init.cli_helper.run import run_command_is_ok
 from atlas_init.settings.config import TestSuite
 from atlas_init.settings.env_vars import AtlasInitSettings
 
 logger = logging.getLogger(__name__)
 
 
 def run_go_tests(
     repo_path: Path,
     repo_alias: str,
     package_prefix: str,
     settings: AtlasInitSettings,
     groups: list[TestSuite],
 ):
-    test_env = os.environ | dotenv.dotenv_values(settings.env_vars_vs_code)
+    extra_vars = settings.load_env_vars(settings.env_vars_vs_code)
+    logger.info(f"go test env-vars-extra: {sorted(extra_vars)}")
+    test_env = os.environ | extra_vars
+    ci_value = test_env.pop("CI", None)
+    if ci_value:
+        logger.warning(f"pooped CI={ci_value}")
     for group in groups:
         packages = ",".join(f"{package_prefix}/{pkg}" for pkg in group.repo_go_packages.get(repo_alias, []))
         if not packages:
             logger.warning(f"no go packages for suite: {group}")
             continue
         command = f"go test {packages} -v -run ^TestAcc* -timeout 300m".split(" ")
         if not group.sequential_tests:
```

## atlas_init/cli_helper/tf_runner.py

```diff
@@ -15,16 +15,16 @@
 )
 from atlas_init.settings.config import TerraformVars, TestSuite
 from atlas_init.settings.env_vars import AtlasInitSettings
 
 logger = logging.getLogger(__name__)
 
 
-def get_tf_vars(settings: AtlasInitSettings, active_groups: list[TestSuite]) -> dict[str, Any]:
-    tf_vars = TerraformVars()
+def get_tf_vars(settings: AtlasInitSettings, active_groups: list[TestSuite]) -> dict[str, Any]:  # type: ignore
+    tf_vars = TerraformVars()  # type: ignore
     tf_vars = sum((group.vars for group in active_groups), start=tf_vars)
     return {
         "atlas_public_key": settings.MONGODB_ATLAS_PUBLIC_KEY,
         "atlas_private_key": settings.MONGODB_ATLAS_PRIVATE_KEY,
         "org_id": settings.MONGODB_ATLAS_ORG_ID,
         "aws_region": settings.AWS_REGION,
         "project_name": settings.project_name,
@@ -37,36 +37,30 @@
 
 class TerraformRunError(Exception):
     pass
 
 
 @dataclass
 class state_copier:  # noqa: N801
-    profile_path: Path
+    state_path: Path
     tf_path: Path
 
-    @property
-    def state_path(self) -> Path:
-        return self.profile_path / "tf_state"
-
     def __enter__(self):
-        if not self.state_path.exists():
-            return
+        self.state_path.mkdir(exist_ok=True, parents=True)
         for state_path, rel_path in iter_paths_and_relative(self.state_path, "terraform.tfstate*", rglob=False):
             copy(state_path, self.tf_path / rel_path)
 
     def __exit__(self, *_):
-        if not self.tf_path.exists():
-            return
+        self.tf_path.mkdir(exist_ok=True, parents=True)
         for state_path, rel_path in iter_paths_and_relative(self.tf_path, "terraform.tfstate*", rglob=False):
             state_path.rename(self.state_path / rel_path)
 
 
 def run_terraform(settings: AtlasInitSettings, command: str, extra_args: list[str]):
-    with state_copier(settings.profile_dir, settings.tf_path):
+    with state_copier(settings.tf_state_path, settings.tf_path):
         _run_terraform(settings, command, extra_args)
 
 
 def _run_terraform(settings: AtlasInitSettings, command: str, extra_args: list[str]):
     command_parts = [
         "terraform",
         command,
@@ -99,16 +93,15 @@
     tf_vars_path.parent.mkdir(exist_ok=True, parents=True)
     tf_vars_str = dump(tf_vars, "pretty_json")
     logger.info(f"writing tf vars to {tf_vars_path}: \n{tf_vars_str}")
     tf_vars_path.write_text(tf_vars_str)
 
 
 def export_outputs(settings: AtlasInitSettings) -> None:
-    output_path = settings.profile_dir / "tf_outputs.json"
-    with state_copier(settings.profile_dir, settings.tf_path):
+    with state_copier(settings.tf_state_path, settings.tf_path):
         result = run_command_receive_result(
             "terraform output -json",
             settings.tf_path,
             logger,
             env=os.environ | {"TF_DATA_DIR": settings.tf_data_dir},
         )
-    output_path.write_text(result)
+    settings.tf_outputs_path.write_text(result)
```

## atlas_init/settings/config.py

```diff
@@ -1,37 +1,39 @@
 from __future__ import annotations
 
 import fnmatch
 import logging
 from collections.abc import Iterable
+from functools import total_ordering
 from pathlib import Path
 from typing import Any
 
-from model_lib import Entity
+from model_lib import Entity, dump_ignore_falsy
 from pydantic import Field, model_validator
 
 from atlas_init.repos.path import owner_project_name
 
 logger = logging.getLogger(__name__)
 
 
+@dump_ignore_falsy
 class TerraformVars(Entity):
     cluster_info: bool = False
     cluster_info_m10: bool = False
     stream_instance: bool = False
     use_private_link: bool = False
     use_vpc_peering: bool = False
     use_project_extra: bool = False
     use_aws_vars: bool = False
     use_aws_vpc: bool = False
     use_aws_s3: bool = False
     use_federated_vars: bool = False
 
-    def __add__(self, other: TerraformVars):
-        assert isinstance(other, TerraformVars)
+    def __add__(self, other: TerraformVars):  # type: ignore
+        assert isinstance(other, TerraformVars)  # type: ignore
         kwargs = {k: v or getattr(other, k) for k, v in self}
         return type(self)(**kwargs)
 
     def as_configs(self) -> dict[str, Any]:
         config = {}
         if self.cluster_info or self.cluster_info_m10:
             instance_size = "M10" if self.cluster_info_m10 else "M0"
@@ -57,22 +59,29 @@
         if self.use_federated_vars:
             config["use_federated_vars"] = True
         if self.stream_instance:
             config["stream_instance_config"] = {"name": "atlas-init"}
         return config
 
 
+@dump_ignore_falsy
+@total_ordering
 class TestSuite(Entity):
     __test__ = False
 
     name: str
     sequential_tests: bool = False
     repo_go_packages: dict[str, list[str]] = Field(default_factory=dict)
     repo_globs: dict[str, list[str]] = Field(default_factory=dict)
-    vars: TerraformVars = Field(default_factory=TerraformVars)
+    vars: TerraformVars = Field(default_factory=TerraformVars)  # type: ignore
+
+    def __lt__(self, other) -> bool:
+        if not isinstance(other, TestSuite):  # type: ignore
+            raise TypeError
+        return self.name < other.name
 
     def all_globs(self, repo_alias: str) -> list[str]:
         go_packages = self.repo_go_packages.get(repo_alias, [])
         return self.repo_globs.get(repo_alias, []) + [f"{pkg}/*.go" for pkg in go_packages] + go_packages
 
     def is_active(self, repo_alias: str, change_paths: Iterable[str]) -> bool:
         """changes paths should be relative to the repo"""
@@ -91,16 +100,16 @@
 class RepoAliasNotFoundError(ValueError):
     def __init__(self, name: str) -> None:
         self.name = name
         super().__init__(name)
 
 
 class AtlasInitConfig(Entity):
-    test_suites: list[TestSuite] = Field(default_factory=list)
     repo_aliases: dict[str, str] = Field(default_factory=dict)
+    test_suites: list[TestSuite] = Field(default_factory=list)  # type: ignore
 
     def repo_alias(self, repo_url_path: str) -> str:
         alias = self.repo_aliases.get(repo_url_path)
         if alias is None:
             raise RepoAliasNotFoundError(repo_url_path)
         return alias
 
@@ -111,15 +120,15 @@
         raise ValueError(f"alias not found: {alias}")
 
     def active_test_suites(
         self,
         alias: str | None,
         change_paths: Iterable[str],
         forced_test_suites: list[str],
-    ) -> list[TestSuite]:
+    ) -> list[TestSuite]:  # type: ignore
         forced_suites = set(forced_test_suites)
         if forced_test_suites:
             logger.warning(f"using forced test suites: {forced_test_suites}")
         return [
             suit
             for suit in self.test_suites
             if suit.name in forced_suites or (alias and suit.is_active(alias, change_paths))
@@ -139,15 +148,15 @@
 
 
 def active_suites(
     config: AtlasInitConfig,
     repo_path: Path,
     cwd_rel_path: str,
     forced_test_suites: list[str],
-) -> list[TestSuite]:
+) -> list[TestSuite]:  # type: ignore
     repo_url_path = owner_project_name(repo_path)
     repo_alias = config.repo_alias(repo_url_path)
     logger.info(f"repo_alias={repo_alias}, repo_path={repo_path}, repo_url_path={repo_url_path}")
     change_paths = [cwd_rel_path]
 
     active_suites = config.active_test_suites(repo_alias, change_paths, forced_test_suites)
     logger.info(f"active_suites: {[s.name for s in active_suites]}")
```

## atlas_init/settings/env_vars.py

```diff
@@ -43,19 +43,19 @@
     TF_CLI_CONFIG_FILE: str = ""
     AWS_PROFILE: str = ""
     AWS_REGION: AwsRegion = "us-east-1"
     MONGODB_ATLAS_ORG_ID: str
     MONGODB_ATLAS_PRIVATE_KEY: str
     MONGODB_ATLAS_PUBLIC_KEY: str
     MONGODB_ATLAS_BASE_URL: str = "https://cloud-dev.mongodb.com/"
-    ci: bool = False
+    non_interactive: bool = False
 
     @property
     def is_interactive(self) -> bool:
-        return not self.ci
+        return not self.non_interactive
 
 
 def as_env_var_name(field_name: str) -> str:
     names = set(field_names(AtlasInitSettings))
     assert (
         field_name in names or field_name.lower() in names
     ), f"unknown field name for {AtlasInitSettings}: {field_name}"
@@ -141,14 +141,25 @@
     def tf_data_dir(self) -> Path:
         return self.profile_dir / ".terraform"
 
     @property
     def tf_vars_path(self) -> Path:
         return self.tf_data_dir / "vars.auto.tfvars.json"
 
+    @property
+    def tf_state_path(self) -> Path:
+        return self.profile_dir / "tf_state"
+
+    @property
+    def tf_outputs_path(self) -> Path:
+        return self.profile_dir / "tf_outputs.json"
+
+    def load_env_vars(self, path: Path) -> dict[str, str]:
+        return load_dotenv(path)
+
     def load_env_vars_generated(self) -> dict[str, str]:
         env_path = self.env_vars_generated
         assert env_path.exists(), f"no env-vars exist {env_path} have you forgotten apply?"
         return load_dotenv(env_path)
 
     def load_profile_manual_env_vars(self) -> dict[str, str]:
         manual_env_vars = self.manual_env_vars
```

## atlas_init/settings/rich_utils.py

```diff
@@ -5,15 +5,50 @@
 from rich.logging import RichHandler
 
 
 class _LogLevel(BaseModel):
     log_level: Literal["INFO", "WARNING", "ERROR", "CRITICAL"]
 
 
-def configure_logging(log_level: str = "INFO"):
+def remove_secrets(message: str, secrets: list[str]) -> str:
+    for secret in secrets:
+        message = message.replace(secret, "***")
+    return message
+
+
+class SecretsHider(logging.Filter):
+    def __init__(self, secrets: list[str], name: str = "") -> None:
+        self.secrets = secrets
+        super().__init__(name)
+
+    def filter(self, record: logging.LogRecord) -> bool:
+        record.msg = remove_secrets(record.msg, self.secrets)
+        return True
+
+
+dangerous_keys = ["key", "id", "secret"]
+safe_keys: list[str] = ["/"]
+
+
+def hide_secrets(handler: logging.Handler, secrets_dict: dict[str, str]) -> None:
+    secrets_to_hide = set()
+    for key, value in secrets_dict.items():
+        if not isinstance(value, str):
+            continue
+        key_lower = key.lower()
+        if any(safe in key_lower for safe in safe_keys):
+            continue
+        if any(danger in key_lower for danger in dangerous_keys):
+            secrets_to_hide.add(value)
+    handler.addFilter(SecretsHider(list(secrets_to_hide), name="secrets-hider"))
+
+
+def configure_logging(log_level: str = "INFO") -> logging.Handler:
     _LogLevel(log_level=log_level)  # type: ignore
+    handler = RichHandler(rich_tracebacks=True)
     logging.basicConfig(
         level=logging.getLevelName(log_level),
         format="%(message)s",
         datefmt="[%X]",
-        handlers=[RichHandler(rich_tracebacks=True)],
+        handlers=[handler],
     )
+    return handler
```

## atlas_init/tf/always.tf

```diff
@@ -5,14 +5,15 @@
 
 resource "random_password" "username" {
   length  = 12
   special = false
 }
 
 data "http" "myip" {
+  count = var.use_project_myip ? 1 : 0
   url = "https://ipv4.icanhazip.com"
 }
 
 data "http" "last_provider_version" {
   url = "https://api.github.com/repos/mongodb/terraform-provider-mongodbatlas/releases/latest"
 
   lifecycle {
@@ -34,10 +35,11 @@
   name   = var.project_name
   org_id = var.org_id
 
   tags = local.tags
 }
 
 resource "mongodbatlas_project_ip_access_list" "mongo-access" {
+  count = var.use_project_myip ? 1 : 0
   project_id = mongodbatlas_project.project.id
-  cidr_block = "${chomp(data.http.myip.response_body)}/32"
-}
+  cidr_block = "${chomp(data.http.myip[0].response_body)}/32"
+}
```

## atlas_init/tf/variables.tf

```diff
@@ -29,14 +29,19 @@
   type = string
   validation {
     condition     = length(var.project_name) < 24
     error_message = "Mongo Project Name must be less than 24 characters."
   }
 }
 
+variable "use_project_myip" {
+  type = bool
+  default = false
+}
+
 variable "out_dir" {
   type = string
 }
 
 variable "cfn_config" {
   type = object({
     profile = string
```

## Comparing `atlas_init-0.1.0.dist-info/METADATA` & `atlas_init-0.1.1.dist-info/METADATA`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.3
 Name: atlas-init
-Version: 0.1.0
+Version: 0.1.1
 Project-URL: Documentation, https://github.com/EspenAlbert/atlas-init#readme
 Project-URL: Issues, https://github.com/EspenAlbert/atlas-init/issues
 Project-URL: Source, https://github.com/EspenAlbert/atlas-init
 Author-email: EspenAlbert <albertespen@gmail.com>
 License-Expression: MIT
 Classifier: Development Status :: 4 - Beta
 Classifier: Programming Language :: Python
@@ -19,15 +19,17 @@
 Requires-Dist: requests==2.31.0
 Requires-Dist: rich==13.7.1
 Requires-Dist: stringcase==1.2.0
 Requires-Dist: tenacity==8.2.3
 Requires-Dist: typer==0.12.0
 Description-Content-Type: text/markdown
 
-# Atlas Init - A CLI for developing with MongoDB Atlas
+# Atlas Init - A CLI for developing integrations with MongoDB Atlas
+
+[![codecov](https://codecov.io/github/EspenAlbert/atlas-init/graph/badge.svg?token=DR7FDJXNZY)](https://codecov.io/github/EspenAlbert/atlas-init)
 
 Currently, used with
 - <https://github.com/mongodb/terraform-provider-mongodbatlas>
 - <https://github.com/mongodb/mongodb/mongodbatlas-cloudformation-resources>
 - see [atlas_init#repo_aliases](atlas_init.yaml) for an up-to-date list
 
 ## Requirements
@@ -64,35 +66,43 @@
 (uv) pip install atlas-init
 # use export ATLAS_INIT_PROFILES_PATH=/somewhere/to/store/your/env-vars/and/tf/state
 ```
 
 ### 2. Local development, run from github repo
 
 ```shell
+git clone https://github.com/EspenAlbert/atlas-init
+cd atlas-init
 brew install pre-commit uv hatch
 # https://github.com/astral-sh/uv <-- python packaging lightning fast
 # https://hatch.pypa.io/latest/ <-- uv compatible build system for python
 
 pre-commit install
 
 # check that everything works
 pre-commit run --all-files
+
+# configure your virtualenv
 cd py
 hatch test
-VENV_PATH=$(hatch env find hatch-test) # your venv path
-cd ..
+export VENV_DIR=$(hatch env find hatch-test | grep py3.12) # hatch venv path for env=hatch-test
+export VENV_PYTHON=$VENV_DIR/bin/python
+$VENV_PYTHON # ensure you are in shell with python3.12 (cmd+d to exit)
+cd .. # back to repo root
 
-# open in your IDE
+# open in your IDE with virtualenv enabled
 code .
-# select venv path from $VENV_PATH output
+# select venv path from $VENV_PYTHON output as python interpreter
 
 # to make it easy to invoke from any terminal
-export pyexe=$(which python) # VENV_PATH above
-export pypath=$(pwd)/py
-echo "alias atlas_init='export PYTHONPATH=$pypath && \"$pyexe\" -m atlas_init'" >> ~/.zprofile # replace with your shell profile
+export pypath=$(pwd)/py # pwd=repo root(atlas-init)
+echo "alias atlas_init='export PYTHONPATH=$pypath && \"$VENV_PYTHON\" -m atlas_init'" >> ~/.zprofile # replace with your shell profile
+
+# test that it works
+atlas_init # should show how to use the cli
 ```
 
 ### 3. `pip install` local wheel
 - will be used by the CI in other repos
 - [atlasci_local_install](atlasci_local_install.sh)
   - creates a local `.venv` builds the wheel from this repo and installs it
 - use `export ATLAS_INIT_PROFILES_PATH=/somewhere/to/store/your/env-vars/and/tf/state`
@@ -136,7 +146,16 @@
  
   }
  
   direct {}
  
 }
 ```
+
+### Re-generating the lock files
+```shell
+terraform providers lock \
+    -platform=darwin_amd64 \
+    -platform=linux_amd64 \
+    -platform=darwin_arm64 \
+    -platform=linux_arm64
+    # -platform=windows_amd64 \
```

## Comparing `atlas_init-0.1.0.dist-info/RECORD` & `atlas_init-0.1.1.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -1,44 +1,45 @@
-atlas_init/__init__.py,sha256=F14PVpz01PXFYFq9nBPKgNteb0-NOECpL4K9CS8TWLY,376
+atlas_init/__init__.py,sha256=nxYhj4r6g5B1cOn6xF2mSn99hp8VxU4lXIg4funFVnc,376
 atlas_init/__main__.py,sha256=dY1dWWvwxRZMmnOFla6RSfti-hMeLeKdoXP7SVYqMUc,52
-atlas_init/atlas_init.yaml,sha256=z1yqKwwjxbYuLs0pJ5v8Ao33ntqdUQo-2hGvYPdkH_I,1552
-atlas_init/cli.py,sha256=XrWxi1_-9lgit4h5e2f_sWpdGEuEUf2bsrHVSP-p88c,9168
+atlas_init/atlas_init.yaml,sha256=qC4zHwmqm6ui9VuAwE3tYrIFDklQ0Gm1Sh9il2l2WdQ,1518
+atlas_init/cli.py,sha256=FbSCjKikTAOrrxyA5cPqqIcEK5hHy4y4pBw6AO46AkM,9639
 atlas_init/cli_args.py,sha256=6ucjRGLGde1XcZIfUCGrWbmQLJB9bWZaXxyAsYXMSSw,427
 atlas_init/terraform.yaml,sha256=5Cxaru1FpnSJqHKRZ7j8YDhMV4h50e3iiahBz3eWlD0,726
 atlas_init/cli_cfn/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atlas_init/cli_cfn/app.py,sha256=6Y_KZ5WH_sOr24AO-7JdwrVsAdGXy5grUE575uIs30U,9857
 atlas_init/cli_cfn/cfn.py,sha256=87G3VpMWmus7pY06rWu_s3lFPAJeYn85I43dH5w0cDQ,12492
 atlas_init/cli_cfn/cfn_parameter_finder.py,sha256=QFlLrWh0g4HwGAlK_M9OmhG61mTtxIBGzSx1VgDSMfs,7441
 atlas_init/cli_helper/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-atlas_init/cli_helper/go.py,sha256=-pmW9CQ45wgAksjHcQ8rGKwu2QB62RYe2M_R4D1ia20,1047
+atlas_init/cli_helper/go.py,sha256=LVMXTWvEYOHOul_UG5uQT3QAoL0H1f1O7e4d-11kPrw,1232
 atlas_init/cli_helper/run.py,sha256=NEjFP1yttPe3Sg9JFnDbRreEWProb-plvKwomBsQz8w,2517
 atlas_init/cli_helper/sdk.py,sha256=exh58-VZwxtosaxM269C62EEy1VnpJPOVziPDPkGsmE,2983
 atlas_init/cli_helper/sdk_auto_changes.py,sha256=oWyXw7P0PdO28hclRvza_RcIVXAyzu0lCYTJTNBDMeo,189
-atlas_init/cli_helper/tf_runner.py,sha256=M4CTfUg5YHnel8vULXx0r63ViFh1tSklKio0t2h4sv8,3799
+atlas_init/cli_helper/tf_runner.py,sha256=vNi8f34LJZkPnvZZnB2MMyfTVMBPwS_1nrD-stO0-iM,3690
 atlas_init/cli_tf/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atlas_init/cli_tf/app.py,sha256=Xspc5qp3f4Uir5hgxcF3DaFg28ld1iWARtbhfq7uI04,2644
 atlas_init/cli_tf/schema.py,sha256=AFALXAju4OBVZQ8T9REtoench6HKmQ88bmmzHC_BxII,3258
 atlas_init/cli_tf/schema_inspection.py,sha256=ujLvGfg3baByND4nRD0drZoI45STxo3VfYvim-PfVOc,1764
 atlas_init/cloud/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atlas_init/cloud/aws.py,sha256=97kkURWHFAKDIw4704aFmyoeAfQKL11IXMyaQbZUt80,2473
 atlas_init/repos/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 atlas_init/repos/cfn.py,sha256=zSrQ_csdh5HsO7Yoc_bC65j9SMsiSYEhd_0ug8gAIb8,2279
 atlas_init/repos/go_sdk.py,sha256=6_ENYMP6yQufo1dXJbLJFDxCuq-8oeTYiGAPC61Uauc,424
 atlas_init/repos/path.py,sha256=N1VdelcMb2YuNbdoZtyL9ChuFEu7Kz4VwOIV7eefzTE,4160
 atlas_init/settings/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-atlas_init/settings/config.py,sha256=0OC1xFSIVhPFub743Aa8kncWH9c4iP7ByIgu9OA3-6Q,5523
-atlas_init/settings/env_vars.py,sha256=NdMAC333wcgQqeUT8xSktNQdaI-fNAnEf7PEreGjvpw,8423
+atlas_init/settings/config.py,sha256=eg1KfDRAbJezpaVTaPYKlteTnzNRm189ZMhg2WPbE9Y,5894
+atlas_init/settings/env_vars.py,sha256=OReAsZ7M4fUZrqSeEoPqizjeRXhEyCpZtB7nqYHdnmY,8745
 atlas_init/settings/interactive.py,sha256=Xy1Z5WMAOSaJ-vQI_4xjAbSR92rWQgnffwVoDT27L68,340
 atlas_init/settings/path.py,sha256=Dbp-C8Cr5Q7E-QSpY6_Pe30nNx_e8hT_RYzKn-3fCO4,1998
-atlas_init/settings/rich_utils.py,sha256=oMHAGlxouJxS0-4IaHww9DTObV91TvrflR6pGJcGF68,491
-atlas_init/tf/always.tf,sha256=QB9FchXSmjZxPfDHtMDk3eRRo9ATL5lFy5wYj8j0UQE,1020
+atlas_init/settings/rich_utils.py,sha256=J75-LGMtGwUAkCwCtjU2DyOeesiFB7rKP54NPb_6UmA,1601
+atlas_init/tf/.terraform.lock.hcl,sha256=wyL4o4Hy1L_9M3U7tXqdZC4OX0uHypCv4MQqZKaeZEI,8206
+atlas_init/tf/always.tf,sha256=dYd7JfxLpeE3sl2jUtbSb6CVya4EuIx9IeFqyE4zCL0,1102
 atlas_init/tf/main.tf,sha256=0ZH1QiBPmE1rQQoOookddfWoNJZLzoQDZPrtGKhkT6c,3824
 atlas_init/tf/outputs.tf,sha256=z5VtLuUia4GPzx3Kw0ECUW68Az0p_zvE8PVtZwPfx4w,3452
 atlas_init/tf/providers.tf,sha256=aBRwlUPQctHMFkFvrXs43Iq9b1og1wo0uSTsbKVt7_g,724
-atlas_init/tf/variables.tf,sha256=uH0Nl5AxCjZd4exPz6hUnrB4b0hpPCTW_3_1C4fWJXw,1860
+atlas_init/tf/variables.tf,sha256=-sW-2lNJD2sOIAodUsN-6SKkLIbznOGYVKVYcxsvPQw,1925
 atlas_init/tf/modules/aws_s3/aws_s3.tf,sha256=SP5vZf5Y2g9Z5yWpBKSKzEEF5FITPycoGKe-kaHoVCI,738
 atlas_init/tf/modules/aws_s3/provider.tf,sha256=MokTWfkT2IPWfIgGbKcX-UC_PycO9TzjZDOeFA9PLRM,162
 atlas_init/tf/modules/aws_vars/aws_vars.tf,sha256=VcVOIt-VCu2UdGddN6SjLkavLl-JGex64RnSEIZhWpw,386
 atlas_init/tf/modules/aws_vpc/aws-vpc.tf,sha256=TnWyDFLHi_aYEnqRCNLDjQmCSUPA0x_4A9fCvXL0vO0,1838
 atlas_init/tf/modules/aws_vpc/provider.tf,sha256=MokTWfkT2IPWfIgGbKcX-UC_PycO9TzjZDOeFA9PLRM,162
 atlas_init/tf/modules/cfn/assume_role_services.yaml,sha256=Sv-FPsLeZ0K_3x0Eq5iJcf7yGe5ax8I0uqzvUlMZDOY,94
 atlas_init/tf/modules/cfn/cfn.tf,sha256=TitYcubYIC4m4cRfGlZXrKH5hhJSR6ot9F9hesR75bM,2065
@@ -51,11 +52,11 @@
 atlas_init/tf/modules/federated_vars/provider.tf,sha256=MokTWfkT2IPWfIgGbKcX-UC_PycO9TzjZDOeFA9PLRM,162
 atlas_init/tf/modules/project_extra/project_extra.tf,sha256=MtF1W9MqyNcIx0KobOujQJ1MsK6r9cPcATAo-aqd62I,1020
 atlas_init/tf/modules/stream_instance/stream_instance.tf,sha256=4HrGfB9ZZZ0BJKwhKINyEmQmqW1FUdgPJBbs8zGWEeE,611
 atlas_init/tf/modules/vpc_peering/vpc_peering.tf,sha256=sRmteM23eTQcrTFLjaxeGTXStOBZQvPpRCIvtVAd8dE,2208
 atlas_init/tf/modules/vpc_privatelink/atlas-privatelink.tf,sha256=FloaaX1MNDvoMZxBnEopeLKyfIlq6kaX2dmx8WWlXNU,1298
 atlas_init/tf/modules/vpc_privatelink/variables.tf,sha256=gktHCDYD4rz6CEpLg5aiXcFbugw4L5S2Fqc52QYdJyc,255
 atlas_init/tf/modules/vpc_privatelink/versions.tf,sha256=GlmYD7fOBe4cbILEXX9UjIr1rJKLIaqL_cDGc2u6upg,238
-atlas_init-0.1.0.dist-info/METADATA,sha256=Kifr-peIohM93DIQcjrJvtH3Yf2BBsDDKp4z7X8rCPs,4763
-atlas_init-0.1.0.dist-info/WHEEL,sha256=zEMcRr9Kr03x1ozGwg5v9NQBKn3kndp6LSoSlVg-jhU,87
-atlas_init-0.1.0.dist-info/entry_points.txt,sha256=6Ycq_NZ7cym1BCA9YiVhYylJzy6woREjt7QSCSLm-1o,54
-atlas_init-0.1.0.dist-info/RECORD,,
+atlas_init-0.1.1.dist-info/METADATA,sha256=Qo8FMgBaZ37BEKYxVvcTQ-FlJ0h96oIOs38nn05wJoI,5504
+atlas_init-0.1.1.dist-info/WHEEL,sha256=zEMcRr9Kr03x1ozGwg5v9NQBKn3kndp6LSoSlVg-jhU,87
+atlas_init-0.1.1.dist-info/entry_points.txt,sha256=6Ycq_NZ7cym1BCA9YiVhYylJzy6woREjt7QSCSLm-1o,54
+atlas_init-0.1.1.dist-info/RECORD,,
```

