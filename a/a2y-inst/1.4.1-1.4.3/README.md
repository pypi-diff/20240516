# Comparing `tmp/a2y_inst-1.4.1-py3-none-any.whl.zip` & `tmp/a2y_inst-1.4.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,15 +1,15 @@
-Zip file size: 68731 bytes, number of entries: 30
+Zip file size: 70528 bytes, number of entries: 30
 -rw-rw-rw-  2.0 fat        0 b- defN 21-Jun-15 02:05 a2y_inst/__init__.py
 -rw-rw-rw-  2.0 fat     1574 b- defN 23-Nov-30 22:29 a2y_inst/ac_power_source.py
 -rw-rw-rw-  2.0 fat     1212 b- defN 23-Jun-23 04:25 a2y_inst/bg7tbl.py
 -rw-rw-rw-  2.0 fat     2489 b- defN 24-Apr-14 14:02 a2y_inst/curing.py
 -rw-rw-rw-  2.0 fat     6418 b- defN 24-Apr-14 14:02 a2y_inst/dispenser.py
--rw-rw-rw-  2.0 fat     2102 b- defN 23-Nov-07 17:59 a2y_inst/dt1309.py
--rw-rw-rw-  2.0 fat     3311 b- defN 24-May-07 15:38 a2y_inst/gwinstek.py
+-rw-rw-rw-  2.0 fat     2573 b- defN 24-May-16 04:16 a2y_inst/dt1309.py
+-rw-rw-rw-  2.0 fat     9966 b- defN 24-May-09 06:50 a2y_inst/gwinstek.py
 -rw-rw-rw-  2.0 fat     6265 b- defN 21-Oct-10 02:43 a2y_inst/itech.py
 -rw-rw-rw-  2.0 fat     2989 b- defN 22-Apr-30 08:17 a2y_inst/jabil.py
 -rw-rw-rw-  2.0 fat     1138 b- defN 21-Jun-15 02:05 a2y_inst/keyence.py
 -rw-rw-rw-  2.0 fat     1275 b- defN 23-Nov-30 22:25 a2y_inst/kld.py
 -rw-rw-rw-  2.0 fat     2494 b- defN 22-Oct-26 07:48 a2y_inst/lb1905.py
 -rw-rw-rw-  2.0 fat     3016 b- defN 23-Nov-22 11:36 a2y_inst/mastech.py
 -rw-rw-rw-  2.0 fat     2568 b- defN 21-Jun-15 02:05 a2y_inst/mind_vision.py
@@ -20,13 +20,13 @@
 -rw-rw-rw-  2.0 fat     1430 b- defN 21-Sep-03 02:14 a2y_inst/shengpu.py
 -rw-rw-rw-  2.0 fat     3237 b- defN 23-Nov-22 01:26 a2y_inst/tes.py
 -rw-rw-rw-  2.0 fat     4416 b- defN 23-Sep-16 07:54 a2y_inst/uhserial.py
 -rw-rw-rw-  2.0 fat     5953 b- defN 22-Jan-07 02:35 a2y_inst/victor.py
 -rw-rw-rw-  2.0 fat     3744 b- defN 21-Jun-15 02:05 a2y_inst/wordop.py
 -rw-rw-rw-  2.0 fat     5925 b- defN 23-Nov-30 22:45 a2y_inst/xinje.py
 -rw-rw-rw-  2.0 fat     4736 b- defN 21-Nov-07 01:07 a2y_inst/yhd.py
--rw-rw-rw-  2.0 fat      718 b- defN 24-May-07 16:06 a2y_inst-1.4.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat     1111 b- defN 24-May-07 16:06 a2y_inst-1.4.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 24-May-07 16:06 a2y_inst-1.4.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        9 b- defN 24-May-07 16:06 a2y_inst-1.4.1.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     2288 b- defN 24-May-07 16:06 a2y_inst-1.4.1.dist-info/RECORD
-30 files, 269759 bytes uncompressed, 65153 bytes compressed:  75.8%
+-rw-rw-rw-  2.0 fat      718 b- defN 24-May-16 04:22 a2y_inst-1.4.3.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat     1384 b- defN 24-May-16 04:22 a2y_inst-1.4.3.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 24-May-16 04:22 a2y_inst-1.4.3.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        9 b- defN 24-May-16 04:22 a2y_inst-1.4.3.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     2288 b- defN 24-May-16 04:22 a2y_inst-1.4.3.dist-info/RECORD
+30 files, 277158 bytes uncompressed, 66950 bytes compressed:  75.8%
```

## zipnote {}

```diff
@@ -69,23 +69,23 @@
 
 Filename: a2y_inst/xinje.py
 Comment: 
 
 Filename: a2y_inst/yhd.py
 Comment: 
 
-Filename: a2y_inst-1.4.1.dist-info/LICENSE
+Filename: a2y_inst-1.4.3.dist-info/LICENSE
 Comment: 
 
-Filename: a2y_inst-1.4.1.dist-info/METADATA
+Filename: a2y_inst-1.4.3.dist-info/METADATA
 Comment: 
 
-Filename: a2y_inst-1.4.1.dist-info/WHEEL
+Filename: a2y_inst-1.4.3.dist-info/WHEEL
 Comment: 
 
-Filename: a2y_inst-1.4.1.dist-info/top_level.txt
+Filename: a2y_inst-1.4.3.dist-info/top_level.txt
 Comment: 
 
-Filename: a2y_inst-1.4.1.dist-info/RECORD
+Filename: a2y_inst-1.4.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## a2y_inst/dt1309.py

```diff
@@ -1,79 +1,101 @@
+from enum import Enum as _Enum
 from serial import Serial as _Serial
 from threading import Thread as _Thread, Event as _Event
 from time import sleep as _sleep
 from typing import Optional as _Optional
 
 
-class DT1309(_Serial):
+class Status(_Enum):
+	Closed = 0
+	Bad = 1
+	Good = 2
+
+
+class DT1309:
 	def __init__(self, port: str):
-		_Serial.__init__(self, port=port, baudrate=9600, timeout=0.5)
+		self.__serial = _Serial(port=port, baudrate=9600, timeout=0.5)
 		self.__value: float = -1
 		self.interval = 0.2
 
 		self.__ready_event = _Event()
 		self.__stop_flag = False
 		self.last_frame = ''
+		self.__status = Status.Closed
 
 		self.__checking_thread: _Optional[_Thread] = None
 		self.start()
 
+	@property
+	def serial(self):
+		return self.__serial
+
 	def start(self):
 		assert self.__checking_thread is None, 'Device has started.'
 		self.__stop_flag = False
+		self.__status = Status.Bad
 		self.__checking_thread = _Thread(target=self.__checker)
 		self.__checking_thread.start()
 
 	def stop(self):
 		if self.__checking_thread is not None:
 			self.__stop_flag = True
+			self.__status = Status.Closed
 			self.__checking_thread.join()
 			self.__checking_thread = None
 
 	def close(self):
 		self.stop()
-		super(DT1309, self).close()
+		self.__serial.close()
 
 	def open(self):
-		super(DT1309, self).open()
-		self.start()
+		if not self.__serial.is_open:
+			self.__serial.open()
+			self.start()
 
 	def __checker(self):
 		while not self.__stop_flag:
-			self.flushInput()
-			self.write(b'\x00\x00')
-			char = self.read()
+			self.__serial.flushInput()
+			self.__serial.write(b'\x00\x00')
+			char = self.__serial.read()
 			timeout = False
 			while char != b'\xCE':
 				if char == b'':
 					timeout = True
 					break
 				else:
-					char = self.read()
+					char = self.__serial.read()
 			if timeout:
+				self.__status = Status.Bad
 				continue
-			data = self.read(4)
+			data = self.__serial.read(4)
 			hex_items = [hex(c)[2:].upper().zfill(2) for c in data]
 			hex_str = ' '.join(hex_items)
 			self.last_frame = f'CE {hex_str}'
 			if len(data) != 4 or data[0] not in [0, 1, 2] or data[1] not in [0x80, 0x88]:
+				self.__status = Status.Bad
 				continue
 			high = int(hex(data[2])[2:])
 			low = int(hex(data[3])[2:])
 			value = high * 100 + low
 			for i in range(data[0]):
 				value = value / 10
 			if data[1] == 0x88:
 				value = value * 1000
 
 			self.__value = value
 			self.__ready_event.set()
+			self.__status = Status.Good
 
 			_sleep(self.interval)
 
 	@property
+	def status(self) -> Status:
+		return self.__status
+
+	@property
 	def lux(self) -> _Optional[float]:
 		assert self.__checking_thread is not None and not self.__stop_flag, 'Device must be started first.'
 		self.__ready_event.clear()
 		if not self.__ready_event.wait(timeout=3):
 			return None
 		return self.__value
```

## a2y_inst/gwinstek.py

```diff
@@ -1,9 +1,11 @@
+from enum import Enum as _Enum
 from serial import Serial as _Serial
-from typing import List as _List
+from time import sleep as _sleep
+from typing import List as _List, Optional
 
 
 class GPP4323Exception(IOError):
 	pass
 
 
 class GPP4323(_Serial):
@@ -113,7 +115,228 @@
 		"""
 		测量所有通道的输出电流实际值，单位：安培
 		"""
 		feedback = self.query(f':measure:current:all?\n')
 		tokens = feedback.split(',')
 		currents = [float(token) for token in tokens]
 		return currents
+
+
+class HVTMode(_Enum):
+	ACW = 'ACW'
+	DCW = 'DCW'
+	IR = 'IR'
+	GB = 'GB'
+
+
+class HVTResult:
+	def __init__(self, mode: HVTMode, result: bool, voltage: float, value: float, test_time: float):
+		self.mode = mode
+		self.result = result
+		self.voltage = voltage
+		self.value = value
+		self.test_time = test_time
+
+		self.__raw = ''
+
+	@property
+	def raw(self) -> str:
+		return self.__raw
+
+	@staticmethod
+	def parse_result(result_str: str):
+		items = result_str.split(',')
+		assert len(items) >= 5, f'GPT9900 测试结果格式错误，逗号分隔至少 5 项：[{result_str}]'
+		mode = HVTMode(items[0].strip())
+		ok = items[1].strip() == 'PASS'
+		voltage = float(items[2].strip()[:-2])
+		value = float(items[3].strip()[:-2])
+		test_time = float(items[4].strip()[2:-1])
+
+		result = HVTResult(
+			mode=mode,
+			result=ok,
+			voltage=voltage,
+			value=value,
+			test_time=test_time
+		)
+		result.__raw = result_str.strip()
+		return result
+
+
+class GPT9900:
+	VerifyWaitTime = 0.1
+
+	def __init__(self, port: str, baudrate: int, timeout: float = 1):
+		self.__serial = _Serial(port=port, baudrate=baudrate, timeout=timeout)
+
+	def close(self):
+		self.__serial.close()
+
+	def __enter__(self):
+		return self
+
+	def __exit__(self, exc_type, exc_val, exc_tb):
+		self.close()
+
+	def query(self, command: str):
+		in_waiting = self.__serial.in_waiting
+		if in_waiting > 0:
+			self.__serial.read(in_waiting)
+		self.__serial.write(command.encode('latin'))
+		if not command.endswith('\n'):
+			self.__serial.write(b'\n')
+		feedback = self.__serial.readline().strip()
+		if not feedback:
+			raise IOError('GPT9904 通信超时')
+		return feedback.decode('latin')
+
+	@property
+	def rise_time(self) -> float:
+		feedback = self.query('MANU:RTime?').lower()
+		assert feedback.endswith(' s'), f'GPT9904 上升时间反馈格式错误，没有以“ S”结尾：[{feedback}]'
+		result = float(feedback[:-2])
+		return round(result, 1)
+
+	def send(self, command: str):
+		self.__serial.write(command.encode('latin'))
+		if not command.endswith('\n'):
+			self.__serial.write(b'\n')
+
+	@rise_time.setter
+	def rise_time(self, value: float):
+		value = round(value, 1)
+		self.send(f'MANU:RTime {value}')
+
+		_sleep(GPT9900.VerifyWaitTime)
+		rtime = self.rise_time
+		assert abs(rtime-value) <= 0.01, f'设置上升时间失败。当前值：{rtime}；目标值：{value}'
+
+	@property
+	def mode(self) -> HVTMode:
+		feedback = self.query('MANU:EDIT:MODE?')
+		return HVTMode(feedback)
+
+	@mode.setter
+	def mode(self, mode: HVTMode):
+		command = f'MANU:EDIT:MODE {mode.value}'
+		self.send(command)
+
+		_sleep(GPT9900.VerifyWaitTime)
+		assert self.mode == mode, f'测试模式设置失败。当前值：{self.mode.value}；目标值：{mode.value}'
+
+	@property
+	def voltage(self) -> float:
+		mode = self.mode
+		command = f'MANU:{mode.value}:VOLTAGE?'
+		feedback = self.query(command).lower()
+		assert feedback.endswith('kv'), f'GPT9904 测试电压反馈格式错误，没有以“ kV”结尾：[{feedback}]'
+		result = float(feedback[:-2])
+		return round(result, 3)
+
+	@voltage.setter
+	def voltage(self, value: float):
+		mode = self.mode
+		voltage = round(value, 3)
+		command = f'MANU:{mode.value}:VOLTAGE {voltage}'
+		self.send(command)
+
+		_sleep(GPT9900.VerifyWaitTime)
+		volt = self.voltage
+		assert abs(volt - voltage) < 0.001, f'测试电压设置失败。当前值：{volt}；目标值：{voltage}'
+
+	@property
+	def test_time(self) -> float:
+		mode = self.mode
+		command = f'MANU:{mode.value}:TTime?'
+		feedback = self.query(command).lower()
+		if 'off' in feedback:
+			return float('inf')
+		assert feedback.endswith(' s'), f'GPT9904 测试时间反馈格式错误，没有以“ S”结尾：[{feedback}]'
+		result = float(feedback[:-2])
+		return round(result, 1)
+
+	@test_time.setter
+	def test_time(self, value: float):
+		mode = self.mode
+		test_time = round(value, 1)
+		command = f'MANU:{mode.value}:TTime {test_time}'
+		self.send(command)
+
+		_sleep(GPT9900.VerifyWaitTime)
+		ttime = self.test_time
+		assert abs(ttime - test_time) < 0.1, f'测试时间设置失败。当前值：{ttime}；目标值：{test_time}'
+
+	@property
+	def current_upper(self) -> float:
+		mode = self.mode
+		command = f'MANU:{mode.value}:CHISet?'
+		feedback = self.query(command).lower()
+		assert feedback.endswith('ma'), f'GPT9904 电流上限反馈格式错误，没有以“mA”结尾：[{feedback}]'
+		result = float(feedback[:-2])
+		return round(result, 3)
+
+	@current_upper.setter
+	def current_upper(self, value: float):
+		mode = self.mode
+		current_upper = round(value, 3)
+		command = f'MANU:{mode.value}:CHISet {current_upper}'
+		self.send(command)
+
+		_sleep(GPT9900.VerifyWaitTime)
+		upper = self.current_upper
+		assert abs(upper - current_upper) < 0.001, f'电流上限设置失败。当前值：{upper}；目标值：{current_upper}'
+
+	@property
+	def current_lower(self) -> float:
+		mode = self.mode
+		command = f'MANU:{mode.value}:CLOSet?'
+		feedback = self.query(command).lower()
+		assert feedback.endswith('ma'), f'GPT9904 电流下限反馈格式错误，没有以“mA”结尾：[{feedback}]'
+		result = float(feedback[:-2])
+		return round(result, 3)
+
+	@current_lower.setter
+	def current_lower(self, value: float):
+		mode = self.mode
+		current_lower = round(value, 3)
+		command = f'MANU:{mode.value}:CLOSet {current_lower}'
+		self.send(command)
+
+		_sleep(GPT9900.VerifyWaitTime)
+		lower = self.current_lower
+		assert abs(lower - current_lower) < 0.001, f'电流下限设置失败。当前值：{lower}；目标值：{current_lower}'
+
+	def prepare(
+			self,
+			mode: HVTMode, voltage: float, test_time: float,
+			current_upper: Optional[float] = None,
+			current_lower: Optional[float] = None
+	):
+		self.mode = mode
+		self.voltage = voltage
+		self.test_time = test_time
+		if current_upper is not None:
+			self.current_upper = current_upper
+		if current_lower is not None:
+			self.current_lower = current_lower
+
+	def start(self):
+		command = 'FUNCTION:TEST ON'
+		self.send(command)
+
+	def stop(self):
+		command = 'FUNCTION: TEST OFF'
+		self.send(command)
+
+	@property
+	def is_testing(self) -> bool:
+		command = 'FUNCTION:TEST?'
+		feedback = self.query(command)
+		fb = feedback.lower()
+		assert 'on' in fb or 'off' in fb, f'测试状态反馈格式错误：[{feedback}]'
+		return 'on' in fb
+
+	@property
+	def measurement(self) -> HVTResult:
+		result_str = self.query('MEASURE?')
+		return HVTResult.parse_result(result_str)
```

## Comparing `a2y_inst-1.4.1.dist-info/LICENSE` & `a2y_inst-1.4.3.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `a2y_inst-1.4.1.dist-info/METADATA` & `a2y_inst-1.4.3.dist-info/METADATA`

 * *Files 18% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: a2y-inst
-Version: 1.4.1
+Version: 1.4.3
 Summary: A module that contains kinds of instrument drivers.
 Home-page: http://www.sorobust.com/a2y/inst.html
 Author: Yu Han
 Author-email: hanjunyu@163.com
 License: Private
 Platform: Windows
 Platform: Linux
@@ -22,10 +22,15 @@
 
 # Python Module: a2y_inst
 ## 简述
 这个模块包含各种外设、仪器的驱动程序。
 ## Build
 python setup.py bdist_wheel
 ## ChangeLog
-2024-05-06 发布版本 1.4.0，初步实现 gwinstek.GPP4323，为对应仪器（多通道程控直流电源）提供驱动。
+2024-05-16 修改 dt1309.DT1309 的实现，不继承 Serial，改为提供 serial 属性；增加 status 属性以方便检查连接状态。
+版本升级为 1.4.3。
+
+2024-05-09 发布版本 1.4.2。加入 gwinstek.GPT9900，一款绝缘耐压测试仪的驱动。
 
 2024-05-08 发布版本 1.4.1。解决 gwinstek.GPP4323.write_command 的代码错误。
+
+2024-05-06 发布版本 1.4.0，初步实现 gwinstek.GPP4323，为对应仪器（多通道程控直流电源）提供驱动。
```

## Comparing `a2y_inst-1.4.1.dist-info/RECORD` & `a2y_inst-1.4.3.dist-info/RECORD`

 * *Files 6% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 a2y_inst/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 a2y_inst/ac_power_source.py,sha256=PDKgR2R92DY2uOkeasoo3AKn1Jur1POHcpLTz24-K4A,1574
 a2y_inst/bg7tbl.py,sha256=aDBuGC_Qn99TZDpQY0JASqGqvJ32eE1LYP-lH_mevpE,1212
 a2y_inst/curing.py,sha256=afNPxcZoxnrMxTtS5QKF_yFSGxIhN6onj0mrMMVOUck,2489
 a2y_inst/dispenser.py,sha256=5dN2wW_ZlrJ_MLufjAvOmgLzW4La-Gt7jfeuVVYvENA,6418
-a2y_inst/dt1309.py,sha256=J6R-b0PK34jDAKPUgPFm5VMBpQOa-4fymc2on_6qJwY,2102
-a2y_inst/gwinstek.py,sha256=_YdRf-pqRPYFh7IO9Mei3IXws6dgBid53oAQnj47N9A,3311
+a2y_inst/dt1309.py,sha256=UC_V2ReJtu2xdA3qRjywbmvyiim98z2NSkFAs9UT40w,2573
+a2y_inst/gwinstek.py,sha256=j3fvKabCj3J8lm1ofMswyvLVHFrlyXhhGAcpXTJ0qvs,9966
 a2y_inst/itech.py,sha256=nHX7mLGVo9OfL55wW3jk-OoucggYx--jm8mfRr9GDvI,6265
 a2y_inst/jabil.py,sha256=oPKe_ln2lX5Mf9RT2pXw3_2ayyYAdudzmXQd4WxoQi4,2989
 a2y_inst/keyence.py,sha256=fnhrqy6kEB0dBflhRYZR7XEfr8C9hhUOtg8Xf4uMK5g,1138
 a2y_inst/kld.py,sha256=sVC-gO_fE9D8KF0QTNABgHLxzOWqIYBMEHKLIso8QfU,1275
 a2y_inst/lb1905.py,sha256=3QbGYJpVNozrAgSzV_d-azr9jLe72U-9xr_T4IfBrSM,2494
 a2y_inst/mastech.py,sha256=QEWVpGzsIij7yovNCW23-5qhUm9I20XP4yydXymuaaE,3016
 a2y_inst/mind_vision.py,sha256=40t76-w-IAu0GG_LV5Qh5bUJTZdmPy1p59EQi7u66dg,2568
@@ -19,12 +19,12 @@
 a2y_inst/shengpu.py,sha256=MeSG47DVE3chmjuYLQKGOdoOC9FK86GklsPC5VNMNCk,1430
 a2y_inst/tes.py,sha256=v2k9ZhiUfm69Z-wT3WJ9dCv8NlL-xl7CqGUrRlQ0xBY,3237
 a2y_inst/uhserial.py,sha256=Z5jsUOxVzjhj9OFOLIUyZFjU9ADIBc7LaWNErvDzYHE,4416
 a2y_inst/victor.py,sha256=B-X7r9L1oYIMX6P30WEEHMuh1scuxumXenqSAHcXbQ0,5953
 a2y_inst/wordop.py,sha256=Wj7-KG8_jl_bZl6p6q7VTtrfsMTMQ6865Rvl4QRox-0,3744
 a2y_inst/xinje.py,sha256=YmtEvEnsEOSodj74JBeBTGUS07IFN3lDikVgvsrcZJg,5925
 a2y_inst/yhd.py,sha256=OZ0FMRpkTRj9eRGQaqb3p4_aDwwQwxmHRR7xxZlboWk,4736
-a2y_inst-1.4.1.dist-info/LICENSE,sha256=7jRZP-sMIeFzANh8v_27Scj1GU6BOPfsQjBqXtTjt6s,718
-a2y_inst-1.4.1.dist-info/METADATA,sha256=s0vFbilz1c9DkVYQzpavQRf23XauldBHrEyGb8_d2hg,1111
-a2y_inst-1.4.1.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
-a2y_inst-1.4.1.dist-info/top_level.txt,sha256=zdZrngJr0mtBXsjq1wZsfdbmkywSqGl0YaiIgkiByEI,9
-a2y_inst-1.4.1.dist-info/RECORD,,
+a2y_inst-1.4.3.dist-info/LICENSE,sha256=7jRZP-sMIeFzANh8v_27Scj1GU6BOPfsQjBqXtTjt6s,718
+a2y_inst-1.4.3.dist-info/METADATA,sha256=fj6_6j57uGO_ykZiyaWl87b6aXZbOODnvqdqRghmNCA,1384
+a2y_inst-1.4.3.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
+a2y_inst-1.4.3.dist-info/top_level.txt,sha256=zdZrngJr0mtBXsjq1wZsfdbmkywSqGl0YaiIgkiByEI,9
+a2y_inst-1.4.3.dist-info/RECORD,,
```

